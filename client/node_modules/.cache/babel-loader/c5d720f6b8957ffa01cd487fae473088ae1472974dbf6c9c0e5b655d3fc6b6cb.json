{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\nimport { GiphyPreviewMessage as DefaultGiphyPreviewMessage } from './GiphyPreviewMessage';\nimport { useGiphyPreview } from './hooks/useGiphyPreview';\nimport { useLastReadData, useNewMessageNotification, usePrependedMessagesCount, useShouldForceScrollToBottom } from './hooks';\nimport { MessageNotification as DefaultMessageNotification } from './MessageNotification';\nimport { MessageListNotifications as DefaultMessageListNotifications } from './MessageListNotifications';\nimport { MessageListMainPanel } from './MessageListMainPanel';\nimport { getGroupStyles, getLastReceived, processMessages } from './utils';\nimport { CUSTOM_MESSAGE_TYPE } from '../../constants/messageTypes';\nimport { DateSeparator as DefaultDateSeparator } from '../DateSeparator/DateSeparator';\nimport { EmptyStateIndicator as DefaultEmptyStateIndicator } from '../EmptyStateIndicator/EmptyStateIndicator';\nimport { EventComponent } from '../EventComponent/EventComponent';\nimport { LoadingIndicator as DefaultLoadingIndicator } from '../Loading/LoadingIndicator';\nimport { Message, MessageSimple } from '../Message';\nimport { useChannelActionContext } from '../../context/ChannelActionContext';\nimport { useChannelStateContext } from '../../context/ChannelStateContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { useComponentContext } from '../../context/ComponentContext';\nimport { isDate } from '../../context/TranslationContext';\nvar PREPEND_OFFSET = Math.pow(10, 7);\nfunction captureResizeObserverExceededError(e) {\n  if (e.message === 'ResizeObserver loop completed with undelivered notifications.' || e.message === 'ResizeObserver loop limit exceeded') {\n    e.stopImmediatePropagation();\n  }\n}\nfunction useCaptureResizeObserverExceededError() {\n  useEffect(function () {\n    window.addEventListener('error', captureResizeObserverExceededError);\n    return function () {\n      window.removeEventListener('error', captureResizeObserverExceededError);\n    };\n  }, []);\n}\nfunction fractionalItemSize(element) {\n  return element.getBoundingClientRect().height;\n}\nfunction findMessageIndex(messages, id) {\n  return messages.findIndex(function (message) {\n    return message.id === id;\n  });\n}\nfunction calculateInitialTopMostItemIndex(messages, highlightedMessageId) {\n  if (highlightedMessageId) {\n    var index = findMessageIndex(messages, highlightedMessageId);\n    if (index !== -1) {\n      return {\n        align: 'center',\n        index: index\n      };\n    }\n  }\n  return messages.length - 1;\n}\nvar VirtualizedMessageListWithContext = function (props) {\n  var additionalVirtuosoProps = props.additionalVirtuosoProps,\n    channel = props.channel,\n    closeReactionSelectorOnClick = props.closeReactionSelectorOnClick,\n    customMessageRenderer = props.customMessageRenderer,\n    defaultItemHeight = props.defaultItemHeight,\n    _a = props.disableDateSeparator,\n    disableDateSeparator = _a === void 0 ? true : _a,\n    groupStyles = props.groupStyles,\n    hasMore = props.hasMore,\n    hasMoreNewer = props.hasMoreNewer,\n    head = props.head,\n    _b = props.hideDeletedMessages,\n    hideDeletedMessages = _b === void 0 ? false : _b,\n    _c = props.hideNewMessageSeparator,\n    hideNewMessageSeparator = _c === void 0 ? false : _c,\n    highlightedMessageId = props.highlightedMessageId,\n    jumpToLatestMessage = props.jumpToLatestMessage,\n    loadingMore = props.loadingMore,\n    loadMore = props.loadMore,\n    loadMoreNewer = props.loadMoreNewer,\n    propMessage = props.Message,\n    _d = props.messageLimit,\n    messageLimit = _d === void 0 ? 100 : _d,\n    messages = props.messages,\n    notifications = props.notifications,\n    // TODO: refactor to scrollSeekPlaceHolderConfiguration and components.ScrollSeekPlaceholder, like the Virtuoso Component\n    _e = props.overscan,\n    // TODO: refactor to scrollSeekPlaceHolderConfiguration and components.ScrollSeekPlaceholder, like the Virtuoso Component\n    overscan = _e === void 0 ? 0 : _e,\n    read = props.read,\n    _f = props.returnAllReadData,\n    returnAllReadData = _f === void 0 ? false : _f,\n    scrollSeekPlaceHolder = props.scrollSeekPlaceHolder,\n    _g = props.scrollToLatestMessageOnFocus,\n    scrollToLatestMessageOnFocus = _g === void 0 ? false : _g,\n    _h = props.separateGiphyPreview,\n    separateGiphyPreview = _h === void 0 ? false : _h,\n    _j = props.shouldGroupByUser,\n    shouldGroupByUser = _j === void 0 ? false : _j,\n    _k = props.stickToBottomScrollBehavior,\n    stickToBottomScrollBehavior = _k === void 0 ? 'smooth' : _k,\n    suppressAutoscroll = props.suppressAutoscroll,\n    threadList = props.threadList;\n  // Stops errors generated from react-virtuoso to bubble up\n  // to Sentry or other tracking tools.\n  useCaptureResizeObserverExceededError();\n  var _l = useComponentContext('VirtualizedMessageList'),\n    _m = _l.DateSeparator,\n    DateSeparator = _m === void 0 ? DefaultDateSeparator : _m,\n    _o = _l.EmptyStateIndicator,\n    EmptyStateIndicator = _o === void 0 ? DefaultEmptyStateIndicator : _o,\n    _p = _l.GiphyPreviewMessage,\n    GiphyPreviewMessage = _p === void 0 ? DefaultGiphyPreviewMessage : _p,\n    _q = _l.LoadingIndicator,\n    LoadingIndicator = _q === void 0 ? DefaultLoadingIndicator : _q,\n    _r = _l.MessageListNotifications,\n    MessageListNotifications = _r === void 0 ? DefaultMessageListNotifications : _r,\n    _s = _l.MessageNotification,\n    MessageNotification = _s === void 0 ? DefaultMessageNotification : _s,\n    _t = _l.MessageSystem,\n    MessageSystem = _t === void 0 ? EventComponent : _t,\n    _u = _l.TypingIndicator,\n    TypingIndicator = _u === void 0 ? null : _u,\n    _v = _l.VirtualMessage,\n    contextMessage = _v === void 0 ? MessageSimple : _v;\n  var _w = useChatContext('VirtualizedMessageList'),\n    client = _w.client,\n    customClasses = _w.customClasses;\n  var lastRead = useMemo(function () {\n    var _a;\n    return (_a = channel.lastRead) === null || _a === void 0 ? void 0 : _a.call(channel);\n  }, [channel]);\n  var MessageUIComponent = propMessage || contextMessage;\n  var _x = useGiphyPreview(separateGiphyPreview),\n    giphyPreviewMessage = _x.giphyPreviewMessage,\n    setGiphyPreviewMessage = _x.setGiphyPreviewMessage;\n  var processedMessages = useMemo(function () {\n    if (typeof messages === 'undefined') {\n      return [];\n    }\n    if (disableDateSeparator && !hideDeletedMessages && hideNewMessageSeparator && !separateGiphyPreview) {\n      return messages;\n    }\n    return processMessages({\n      enableDateSeparator: !disableDateSeparator,\n      hideDeletedMessages: hideDeletedMessages,\n      hideNewMessageSeparator: hideNewMessageSeparator,\n      lastRead: lastRead,\n      messages: messages,\n      setGiphyPreviewMessage: setGiphyPreviewMessage,\n      userId: client.userID || ''\n    });\n  }, [disableDateSeparator, hideDeletedMessages, hideNewMessageSeparator, lastRead, messages, messages === null || messages === void 0 ? void 0 : messages.length, client.userID]);\n  // get the mapping of own messages to array of users who read them\n  var ownMessagesReadByOthers = useLastReadData({\n    messages: processedMessages,\n    read: read,\n    returnAllReadData: returnAllReadData,\n    userID: client.userID\n  });\n  var lastReceivedMessageId = useMemo(function () {\n    return getLastReceived(processedMessages);\n  }, [processedMessages]);\n  var groupStylesFn = groupStyles || getGroupStyles;\n  var messageGroupStyles = useMemo(function () {\n    return processedMessages.reduce(function (acc, message, i) {\n      var style = groupStylesFn(message, processedMessages[i - 1], processedMessages[i + 1], !shouldGroupByUser);\n      if (style) acc[message.id] = style;\n      return acc;\n    }, {});\n  },\n  // processedMessages were incorrectly rebuilt with a new object identity at some point, hence the .length usage\n  [processedMessages.length, shouldGroupByUser]);\n  var virtuoso = useRef(null);\n  var _y = useNewMessageNotification(processedMessages, client.userID, hasMoreNewer),\n    atBottom = _y.atBottom,\n    isMessageListScrolledToBottom = _y.isMessageListScrolledToBottom,\n    newMessagesNotification = _y.newMessagesNotification,\n    setIsMessageListScrolledToBottom = _y.setIsMessageListScrolledToBottom,\n    setNewMessagesNotification = _y.setNewMessagesNotification;\n  var scrollToBottom = useCallback(function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!hasMoreNewer) return [3 /*break*/, 2];\n            return [4 /*yield*/, jumpToLatestMessage()];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n          case 2:\n            if (virtuoso.current) {\n              virtuoso.current.scrollToIndex(processedMessages.length - 1);\n            }\n            setNewMessagesNotification(false);\n            return [2 /*return*/];\n        }\n      });\n    });\n  }, [virtuoso, processedMessages, setNewMessagesNotification,\n  // processedMessages were incorrectly rebuilt with a new object identity at some point, hence the .length usage\n  processedMessages.length, hasMoreNewer, jumpToLatestMessage]);\n  var _z = React.useState(false),\n    newMessagesReceivedInBackground = _z[0],\n    setNewMessagesReceivedInBackground = _z[1];\n  var resetNewMessagesReceivedInBackground = useCallback(function () {\n    setNewMessagesReceivedInBackground(false);\n  }, []);\n  useEffect(function () {\n    setNewMessagesReceivedInBackground(true);\n  }, [messages]);\n  var scrollToBottomIfConfigured = useCallback(function (event) {\n    if (scrollToLatestMessageOnFocus && event.target === window) {\n      if (newMessagesReceivedInBackground) {\n        setTimeout(scrollToBottom, 100);\n      }\n    }\n  }, [scrollToLatestMessageOnFocus, scrollToBottom, newMessagesReceivedInBackground]);\n  useEffect(function () {\n    if (typeof window !== 'undefined') {\n      window.addEventListener('focus', scrollToBottomIfConfigured);\n      window.addEventListener('blur', resetNewMessagesReceivedInBackground);\n    }\n    return function () {\n      window.removeEventListener('focus', scrollToBottomIfConfigured);\n      window.removeEventListener('blur', resetNewMessagesReceivedInBackground);\n    };\n  }, [scrollToBottomIfConfigured]);\n  var numItemsPrepended = usePrependedMessagesCount(processedMessages, !disableDateSeparator);\n  /**\n   * Logic to update the key of the virtuoso component when the list jumps to a new location.\n   */\n  var _0 = useState(+new Date()),\n    messageSetKey = _0[0],\n    setMessageSetKey = _0[1];\n  var firstMessageId = useRef();\n  useEffect(function () {\n    var _a;\n    var continuousSet = messages === null || messages === void 0 ? void 0 : messages.find(function (message) {\n      return message.id === firstMessageId.current;\n    });\n    if (!continuousSet) {\n      setMessageSetKey(+new Date());\n    }\n    firstMessageId.current = (_a = messages === null || messages === void 0 ? void 0 : messages[0]) === null || _a === void 0 ? void 0 : _a.id;\n  }, [messages]);\n  var shouldForceScrollToBottom = useShouldForceScrollToBottom(processedMessages, client.userID);\n  var followOutput = function (isAtBottom) {\n    if (hasMoreNewer || suppressAutoscroll) {\n      return false;\n    }\n    if (shouldForceScrollToBottom()) {\n      return isAtBottom ? stickToBottomScrollBehavior : 'auto';\n    }\n    // a message from another user has been received - don't scroll to bottom unless already there\n    return isAtBottom ? stickToBottomScrollBehavior : false;\n  };\n  var messageRenderer = useCallback(function (messageList, virtuosoIndex, virtuosoContext) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n    var lastReceivedMessageId = virtuosoContext.lastReceivedMessageId,\n      ownMessagesReadByOthers = virtuosoContext.ownMessagesReadByOthers;\n    var streamMessageIndex = virtuosoIndex + numItemsPrepended - PREPEND_OFFSET;\n    // use custom renderer supplied by client if present and skip the rest\n    if (customMessageRenderer) {\n      return customMessageRenderer(messageList, streamMessageIndex);\n    }\n    var message = messageList[streamMessageIndex];\n    if (message.customType === CUSTOM_MESSAGE_TYPE.date && message.date && isDate(message.date)) {\n      return React.createElement(DateSeparator, {\n        date: message.date,\n        unread: message.unread\n      });\n    }\n    if (!message) return React.createElement(\"div\", {\n      style: {\n        height: '1px'\n      }\n    }); // returning null or zero height breaks the virtuoso\n    if (message.type === 'system') {\n      return React.createElement(MessageSystem, {\n        message: message\n      });\n    }\n    var groupedByUser = shouldGroupByUser && streamMessageIndex > 0 && ((_a = message.user) === null || _a === void 0 ? void 0 : _a.id) === ((_b = messageList[streamMessageIndex - 1].user) === null || _b === void 0 ? void 0 : _b.id);\n    var firstOfGroup = shouldGroupByUser && ((_c = message.user) === null || _c === void 0 ? void 0 : _c.id) !== ((_e = (_d = messageList[streamMessageIndex - 1]) === null || _d === void 0 ? void 0 : _d.user) === null || _e === void 0 ? void 0 : _e.id);\n    var endOfGroup = shouldGroupByUser && ((_f = message.user) === null || _f === void 0 ? void 0 : _f.id) !== ((_h = (_g = messageList[streamMessageIndex + 1]) === null || _g === void 0 ? void 0 : _g.user) === null || _h === void 0 ? void 0 : _h.id);\n    return React.createElement(Message, {\n      additionalMessageInputProps: props.additionalMessageInputProps,\n      autoscrollToBottom: (_j = virtuoso.current) === null || _j === void 0 ? void 0 : _j.autoscrollToBottom,\n      closeReactionSelectorOnClick: closeReactionSelectorOnClick,\n      customMessageActions: props.customMessageActions,\n      endOfGroup: endOfGroup,\n      firstOfGroup: firstOfGroup,\n      groupedByUser: groupedByUser,\n      lastReceivedId: lastReceivedMessageId,\n      message: message,\n      Message: MessageUIComponent,\n      messageActions: props.messageActions,\n      readBy: ownMessagesReadByOthers[message.id] || []\n    });\n  }, [customMessageRenderer, shouldGroupByUser, numItemsPrepended]);\n  var Item = useMemo(function () {\n    // using 'display: inline-block'\n    // traps CSS margins of the item elements, preventing incorrect item measurements\n    var Item = function (props) {\n      var _a;\n      var _b;\n      var context = props.context;\n      var streamMessageIndex = props['data-item-index'] + context.numItemsPrepended - PREPEND_OFFSET;\n      var message = context.processedMessages[streamMessageIndex];\n      var groupStyles = context.messageGroupStyles[message.id] || '';\n      return React.createElement(\"div\", __assign({}, props, {\n        className: ((_b = context === null || context === void 0 ? void 0 : context.customClasses) === null || _b === void 0 ? void 0 : _b.virtualMessage) || clsx('str-chat__virtual-list-message-wrapper str-chat__li', (_a = {}, _a[\"str-chat__li--\".concat(groupStyles)] = groupStyles, _a))\n      }));\n    };\n    return Item;\n  }, []);\n  var virtuosoComponents = useMemo(function () {\n    var EmptyPlaceholder = function () {\n      return React.createElement(React.Fragment, null, EmptyStateIndicator && React.createElement(EmptyStateIndicator, {\n        listType: threadList ? 'thread' : 'message'\n      }));\n    };\n    var Header = function () {\n      return loadingMore ? React.createElement(\"div\", {\n        className: 'str-chat__virtual-list__loading'\n      }, React.createElement(LoadingIndicator, {\n        size: 20\n      })) : head || null;\n    };\n    var Footer = function () {\n      return TypingIndicator ? React.createElement(TypingIndicator, {\n        avatarSize: 24\n      }) : React.createElement(React.Fragment, null);\n    };\n    return {\n      EmptyPlaceholder: EmptyPlaceholder,\n      Footer: Footer,\n      Header: Header,\n      Item: Item\n    };\n  }, [loadingMore, head, Item]);\n  var atBottomStateChange = function (isAtBottom) {\n    atBottom.current = isAtBottom;\n    setIsMessageListScrolledToBottom(isAtBottom);\n    if (isAtBottom && newMessagesNotification) {\n      setNewMessagesNotification(false);\n    }\n  };\n  var startReached = function () {\n    if (hasMore && loadMore) {\n      loadMore(messageLimit);\n    }\n  };\n  var endReached = function () {\n    if (hasMoreNewer && loadMoreNewer) {\n      loadMoreNewer(messageLimit);\n    }\n  };\n  useEffect(function () {\n    var _a;\n    if (highlightedMessageId) {\n      var index = findMessageIndex(processedMessages, highlightedMessageId);\n      if (index !== -1) {\n        (_a = virtuoso.current) === null || _a === void 0 ? void 0 : _a.scrollToIndex({\n          align: 'center',\n          index: index\n        });\n      }\n    }\n  }, [highlightedMessageId]);\n  if (!processedMessages) return null;\n  return React.createElement(React.Fragment, null, React.createElement(MessageListMainPanel, null, React.createElement(\"div\", {\n    className: (customClasses === null || customClasses === void 0 ? void 0 : customClasses.virtualizedMessageList) || 'str-chat__virtual-list'\n  }, React.createElement(Virtuoso, __assign({\n    atBottomStateChange: atBottomStateChange,\n    atBottomThreshold: 200,\n    className: 'str-chat__message-list-scroll',\n    components: virtuosoComponents,\n    computeItemKey: function (index) {\n      return processedMessages[numItemsPrepended + index - PREPEND_OFFSET].id;\n    },\n    context: {\n      customClasses: customClasses,\n      lastReceivedMessageId: lastReceivedMessageId,\n      messageGroupStyles: messageGroupStyles,\n      numItemsPrepended: numItemsPrepended,\n      ownMessagesReadByOthers: ownMessagesReadByOthers,\n      processedMessages: processedMessages\n    },\n    endReached: endReached,\n    firstItemIndex: PREPEND_OFFSET - numItemsPrepended,\n    followOutput: followOutput,\n    increaseViewportBy: {\n      bottom: 200,\n      top: 0\n    },\n    initialTopMostItemIndex: calculateInitialTopMostItemIndex(processedMessages, highlightedMessageId),\n    itemContent: function (i, _, context) {\n      return messageRenderer(processedMessages, i, context);\n    },\n    itemSize: fractionalItemSize,\n    key: messageSetKey,\n    overscan: overscan,\n    ref: virtuoso,\n    startReached: startReached,\n    style: {\n      overflowX: 'hidden'\n    },\n    totalCount: processedMessages.length\n  }, additionalVirtuosoProps, scrollSeekPlaceHolder ? {\n    scrollSeek: scrollSeekPlaceHolder\n  } : {}, defaultItemHeight ? {\n    defaultItemHeight: defaultItemHeight\n  } : {})))), React.createElement(MessageListNotifications, {\n    hasNewMessages: newMessagesNotification,\n    isMessageListScrolledToBottom: isMessageListScrolledToBottom,\n    isNotAtLatestMessageSet: hasMoreNewer,\n    MessageNotification: MessageNotification,\n    notifications: notifications,\n    scrollToBottom: scrollToBottom,\n    threadList: threadList\n  }), giphyPreviewMessage && React.createElement(GiphyPreviewMessage, {\n    message: giphyPreviewMessage\n  }));\n};\n/**\n * The VirtualizedMessageList component renders a list of messages in a virtualized list.\n * It is a consumer of the React contexts set in [Channel](https://github.com/GetStream/stream-chat-react/blob/master/src/components/Channel/Channel.tsx).\n */\nexport function VirtualizedMessageList(props) {\n  var _a = useChannelActionContext('VirtualizedMessageList'),\n    jumpToLatestMessage = _a.jumpToLatestMessage,\n    loadMore = _a.loadMore,\n    loadMoreNewer = _a.loadMoreNewer;\n  var _b = useChannelStateContext('VirtualizedMessageList'),\n    channel = _b.channel,\n    hasMore = _b.hasMore,\n    hasMoreNewer = _b.hasMoreNewer,\n    highlightedMessageId = _b.highlightedMessageId,\n    loadingMore = _b.loadingMore,\n    loadingMoreNewer = _b.loadingMoreNewer,\n    contextMessages = _b.messages,\n    notifications = _b.notifications,\n    read = _b.read,\n    suppressAutoscroll = _b.suppressAutoscroll;\n  var messages = props.messages || contextMessages;\n  return React.createElement(VirtualizedMessageListWithContext, __assign({\n    channel: channel,\n    hasMore: !!hasMore,\n    hasMoreNewer: !!hasMoreNewer,\n    highlightedMessageId: highlightedMessageId,\n    jumpToLatestMessage: jumpToLatestMessage,\n    loadingMore: !!loadingMore,\n    loadingMoreNewer: !!loadingMoreNewer,\n    loadMore: loadMore,\n    loadMoreNewer: loadMoreNewer,\n    messages: messages,\n    notifications: notifications,\n    read: read,\n    suppressAutoscroll: suppressAutoscroll\n  }, props));\n}","map":{"version":3,"names":["__assign","__awaiter","__generator","clsx","React","useCallback","useEffect","useMemo","useRef","useState","Virtuoso","GiphyPreviewMessage","DefaultGiphyPreviewMessage","useGiphyPreview","useLastReadData","useNewMessageNotification","usePrependedMessagesCount","useShouldForceScrollToBottom","MessageNotification","DefaultMessageNotification","MessageListNotifications","DefaultMessageListNotifications","MessageListMainPanel","getGroupStyles","getLastReceived","processMessages","CUSTOM_MESSAGE_TYPE","DateSeparator","DefaultDateSeparator","EmptyStateIndicator","DefaultEmptyStateIndicator","EventComponent","LoadingIndicator","DefaultLoadingIndicator","Message","MessageSimple","useChannelActionContext","useChannelStateContext","useChatContext","useComponentContext","isDate","PREPEND_OFFSET","Math","pow","captureResizeObserverExceededError","e","message","stopImmediatePropagation","useCaptureResizeObserverExceededError","window","addEventListener","removeEventListener","fractionalItemSize","element","getBoundingClientRect","height","findMessageIndex","messages","id","findIndex","calculateInitialTopMostItemIndex","highlightedMessageId","index","align","length","VirtualizedMessageListWithContext","props","additionalVirtuosoProps","channel","closeReactionSelectorOnClick","customMessageRenderer","defaultItemHeight","_a","disableDateSeparator","groupStyles","hasMore","hasMoreNewer","head","_b","hideDeletedMessages","_c","hideNewMessageSeparator","jumpToLatestMessage","loadingMore","loadMore","loadMoreNewer","propMessage","_d","messageLimit","notifications","_e","overscan","read","_f","returnAllReadData","scrollSeekPlaceHolder","_g","scrollToLatestMessageOnFocus","_h","separateGiphyPreview","_j","shouldGroupByUser","_k","stickToBottomScrollBehavior","suppressAutoscroll","threadList","_l","_m","_o","_p","_q","_r","_s","_t","MessageSystem","_u","TypingIndicator","_v","VirtualMessage","contextMessage","_w","client","customClasses","lastRead","call","MessageUIComponent","_x","giphyPreviewMessage","setGiphyPreviewMessage","processedMessages","enableDateSeparator","userId","userID","ownMessagesReadByOthers","lastReceivedMessageId","groupStylesFn","messageGroupStyles","reduce","acc","i","style","virtuoso","_y","atBottom","isMessageListScrolledToBottom","newMessagesNotification","setIsMessageListScrolledToBottom","setNewMessagesNotification","scrollToBottom","label","sent","current","scrollToIndex","_z","newMessagesReceivedInBackground","setNewMessagesReceivedInBackground","resetNewMessagesReceivedInBackground","scrollToBottomIfConfigured","event","target","setTimeout","numItemsPrepended","_0","Date","messageSetKey","setMessageSetKey","firstMessageId","continuousSet","find","shouldForceScrollToBottom","followOutput","isAtBottom","messageRenderer","messageList","virtuosoIndex","virtuosoContext","streamMessageIndex","customType","date","createElement","unread","type","groupedByUser","user","firstOfGroup","endOfGroup","additionalMessageInputProps","autoscrollToBottom","customMessageActions","lastReceivedId","messageActions","readBy","Item","context","className","virtualMessage","concat","virtuosoComponents","EmptyPlaceholder","Fragment","listType","Header","size","Footer","avatarSize","atBottomStateChange","startReached","endReached","virtualizedMessageList","atBottomThreshold","components","computeItemKey","firstItemIndex","increaseViewportBy","bottom","top","initialTopMostItemIndex","itemContent","_","itemSize","key","ref","overflowX","totalCount","scrollSeek","hasNewMessages","isNotAtLatestMessageSet","VirtualizedMessageList","loadingMoreNewer","contextMessages"],"sources":["C:/Users/praka/OneDrive/Desktop/Tic-Tac-Toe/client/node_modules/stream-chat-react/dist/components/MessageList/VirtualizedMessageList.js"],"sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { Virtuoso, } from 'react-virtuoso';\nimport { GiphyPreviewMessage as DefaultGiphyPreviewMessage } from './GiphyPreviewMessage';\nimport { useGiphyPreview } from './hooks/useGiphyPreview';\nimport { useLastReadData, useNewMessageNotification, usePrependedMessagesCount, useShouldForceScrollToBottom, } from './hooks';\nimport { MessageNotification as DefaultMessageNotification } from './MessageNotification';\nimport { MessageListNotifications as DefaultMessageListNotifications } from './MessageListNotifications';\nimport { MessageListMainPanel } from './MessageListMainPanel';\nimport { getGroupStyles, getLastReceived, processMessages } from './utils';\nimport { CUSTOM_MESSAGE_TYPE } from '../../constants/messageTypes';\nimport { DateSeparator as DefaultDateSeparator } from '../DateSeparator/DateSeparator';\nimport { EmptyStateIndicator as DefaultEmptyStateIndicator } from '../EmptyStateIndicator/EmptyStateIndicator';\nimport { EventComponent } from '../EventComponent/EventComponent';\nimport { LoadingIndicator as DefaultLoadingIndicator } from '../Loading/LoadingIndicator';\nimport { Message, MessageSimple } from '../Message';\nimport { useChannelActionContext, } from '../../context/ChannelActionContext';\nimport { useChannelStateContext, } from '../../context/ChannelStateContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { useComponentContext } from '../../context/ComponentContext';\nimport { isDate } from '../../context/TranslationContext';\nvar PREPEND_OFFSET = Math.pow(10, 7);\nfunction captureResizeObserverExceededError(e) {\n    if (e.message === 'ResizeObserver loop completed with undelivered notifications.' ||\n        e.message === 'ResizeObserver loop limit exceeded') {\n        e.stopImmediatePropagation();\n    }\n}\nfunction useCaptureResizeObserverExceededError() {\n    useEffect(function () {\n        window.addEventListener('error', captureResizeObserverExceededError);\n        return function () {\n            window.removeEventListener('error', captureResizeObserverExceededError);\n        };\n    }, []);\n}\nfunction fractionalItemSize(element) {\n    return element.getBoundingClientRect().height;\n}\nfunction findMessageIndex(messages, id) {\n    return messages.findIndex(function (message) { return message.id === id; });\n}\nfunction calculateInitialTopMostItemIndex(messages, highlightedMessageId) {\n    if (highlightedMessageId) {\n        var index = findMessageIndex(messages, highlightedMessageId);\n        if (index !== -1) {\n            return { align: 'center', index: index };\n        }\n    }\n    return messages.length - 1;\n}\nvar VirtualizedMessageListWithContext = function (props) {\n    var additionalVirtuosoProps = props.additionalVirtuosoProps, channel = props.channel, closeReactionSelectorOnClick = props.closeReactionSelectorOnClick, customMessageRenderer = props.customMessageRenderer, defaultItemHeight = props.defaultItemHeight, _a = props.disableDateSeparator, disableDateSeparator = _a === void 0 ? true : _a, groupStyles = props.groupStyles, hasMore = props.hasMore, hasMoreNewer = props.hasMoreNewer, head = props.head, _b = props.hideDeletedMessages, hideDeletedMessages = _b === void 0 ? false : _b, _c = props.hideNewMessageSeparator, hideNewMessageSeparator = _c === void 0 ? false : _c, highlightedMessageId = props.highlightedMessageId, jumpToLatestMessage = props.jumpToLatestMessage, loadingMore = props.loadingMore, loadMore = props.loadMore, loadMoreNewer = props.loadMoreNewer, propMessage = props.Message, _d = props.messageLimit, messageLimit = _d === void 0 ? 100 : _d, messages = props.messages, notifications = props.notifications, \n    // TODO: refactor to scrollSeekPlaceHolderConfiguration and components.ScrollSeekPlaceholder, like the Virtuoso Component\n    _e = props.overscan, \n    // TODO: refactor to scrollSeekPlaceHolderConfiguration and components.ScrollSeekPlaceholder, like the Virtuoso Component\n    overscan = _e === void 0 ? 0 : _e, read = props.read, _f = props.returnAllReadData, returnAllReadData = _f === void 0 ? false : _f, scrollSeekPlaceHolder = props.scrollSeekPlaceHolder, _g = props.scrollToLatestMessageOnFocus, scrollToLatestMessageOnFocus = _g === void 0 ? false : _g, _h = props.separateGiphyPreview, separateGiphyPreview = _h === void 0 ? false : _h, _j = props.shouldGroupByUser, shouldGroupByUser = _j === void 0 ? false : _j, _k = props.stickToBottomScrollBehavior, stickToBottomScrollBehavior = _k === void 0 ? 'smooth' : _k, suppressAutoscroll = props.suppressAutoscroll, threadList = props.threadList;\n    // Stops errors generated from react-virtuoso to bubble up\n    // to Sentry or other tracking tools.\n    useCaptureResizeObserverExceededError();\n    var _l = useComponentContext('VirtualizedMessageList'), _m = _l.DateSeparator, DateSeparator = _m === void 0 ? DefaultDateSeparator : _m, _o = _l.EmptyStateIndicator, EmptyStateIndicator = _o === void 0 ? DefaultEmptyStateIndicator : _o, _p = _l.GiphyPreviewMessage, GiphyPreviewMessage = _p === void 0 ? DefaultGiphyPreviewMessage : _p, _q = _l.LoadingIndicator, LoadingIndicator = _q === void 0 ? DefaultLoadingIndicator : _q, _r = _l.MessageListNotifications, MessageListNotifications = _r === void 0 ? DefaultMessageListNotifications : _r, _s = _l.MessageNotification, MessageNotification = _s === void 0 ? DefaultMessageNotification : _s, _t = _l.MessageSystem, MessageSystem = _t === void 0 ? EventComponent : _t, _u = _l.TypingIndicator, TypingIndicator = _u === void 0 ? null : _u, _v = _l.VirtualMessage, contextMessage = _v === void 0 ? MessageSimple : _v;\n    var _w = useChatContext('VirtualizedMessageList'), client = _w.client, customClasses = _w.customClasses;\n    var lastRead = useMemo(function () { var _a; return (_a = channel.lastRead) === null || _a === void 0 ? void 0 : _a.call(channel); }, [channel]);\n    var MessageUIComponent = propMessage || contextMessage;\n    var _x = useGiphyPreview(separateGiphyPreview), giphyPreviewMessage = _x.giphyPreviewMessage, setGiphyPreviewMessage = _x.setGiphyPreviewMessage;\n    var processedMessages = useMemo(function () {\n        if (typeof messages === 'undefined') {\n            return [];\n        }\n        if (disableDateSeparator &&\n            !hideDeletedMessages &&\n            hideNewMessageSeparator &&\n            !separateGiphyPreview) {\n            return messages;\n        }\n        return processMessages({\n            enableDateSeparator: !disableDateSeparator,\n            hideDeletedMessages: hideDeletedMessages,\n            hideNewMessageSeparator: hideNewMessageSeparator,\n            lastRead: lastRead,\n            messages: messages,\n            setGiphyPreviewMessage: setGiphyPreviewMessage,\n            userId: client.userID || '',\n        });\n    }, [\n        disableDateSeparator,\n        hideDeletedMessages,\n        hideNewMessageSeparator,\n        lastRead,\n        messages,\n        messages === null || messages === void 0 ? void 0 : messages.length,\n        client.userID,\n    ]);\n    // get the mapping of own messages to array of users who read them\n    var ownMessagesReadByOthers = useLastReadData({\n        messages: processedMessages,\n        read: read,\n        returnAllReadData: returnAllReadData,\n        userID: client.userID,\n    });\n    var lastReceivedMessageId = useMemo(function () { return getLastReceived(processedMessages); }, [\n        processedMessages,\n    ]);\n    var groupStylesFn = groupStyles || getGroupStyles;\n    var messageGroupStyles = useMemo(function () {\n        return processedMessages.reduce(function (acc, message, i) {\n            var style = groupStylesFn(message, processedMessages[i - 1], processedMessages[i + 1], !shouldGroupByUser);\n            if (style)\n                acc[message.id] = style;\n            return acc;\n        }, {});\n    }, \n    // processedMessages were incorrectly rebuilt with a new object identity at some point, hence the .length usage\n    [processedMessages.length, shouldGroupByUser]);\n    var virtuoso = useRef(null);\n    var _y = useNewMessageNotification(processedMessages, client.userID, hasMoreNewer), atBottom = _y.atBottom, isMessageListScrolledToBottom = _y.isMessageListScrolledToBottom, newMessagesNotification = _y.newMessagesNotification, setIsMessageListScrolledToBottom = _y.setIsMessageListScrolledToBottom, setNewMessagesNotification = _y.setNewMessagesNotification;\n    var scrollToBottom = useCallback(function () { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!hasMoreNewer) return [3 /*break*/, 2];\n                    return [4 /*yield*/, jumpToLatestMessage()];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n                case 2:\n                    if (virtuoso.current) {\n                        virtuoso.current.scrollToIndex(processedMessages.length - 1);\n                    }\n                    setNewMessagesNotification(false);\n                    return [2 /*return*/];\n            }\n        });\n    }); }, [\n        virtuoso,\n        processedMessages,\n        setNewMessagesNotification,\n        // processedMessages were incorrectly rebuilt with a new object identity at some point, hence the .length usage\n        processedMessages.length,\n        hasMoreNewer,\n        jumpToLatestMessage,\n    ]);\n    var _z = React.useState(false), newMessagesReceivedInBackground = _z[0], setNewMessagesReceivedInBackground = _z[1];\n    var resetNewMessagesReceivedInBackground = useCallback(function () {\n        setNewMessagesReceivedInBackground(false);\n    }, []);\n    useEffect(function () {\n        setNewMessagesReceivedInBackground(true);\n    }, [messages]);\n    var scrollToBottomIfConfigured = useCallback(function (event) {\n        if (scrollToLatestMessageOnFocus && event.target === window) {\n            if (newMessagesReceivedInBackground) {\n                setTimeout(scrollToBottom, 100);\n            }\n        }\n    }, [scrollToLatestMessageOnFocus, scrollToBottom, newMessagesReceivedInBackground]);\n    useEffect(function () {\n        if (typeof window !== 'undefined') {\n            window.addEventListener('focus', scrollToBottomIfConfigured);\n            window.addEventListener('blur', resetNewMessagesReceivedInBackground);\n        }\n        return function () {\n            window.removeEventListener('focus', scrollToBottomIfConfigured);\n            window.removeEventListener('blur', resetNewMessagesReceivedInBackground);\n        };\n    }, [scrollToBottomIfConfigured]);\n    var numItemsPrepended = usePrependedMessagesCount(processedMessages, !disableDateSeparator);\n    /**\n     * Logic to update the key of the virtuoso component when the list jumps to a new location.\n     */\n    var _0 = useState(+new Date()), messageSetKey = _0[0], setMessageSetKey = _0[1];\n    var firstMessageId = useRef();\n    useEffect(function () {\n        var _a;\n        var continuousSet = messages === null || messages === void 0 ? void 0 : messages.find(function (message) { return message.id === firstMessageId.current; });\n        if (!continuousSet) {\n            setMessageSetKey(+new Date());\n        }\n        firstMessageId.current = (_a = messages === null || messages === void 0 ? void 0 : messages[0]) === null || _a === void 0 ? void 0 : _a.id;\n    }, [messages]);\n    var shouldForceScrollToBottom = useShouldForceScrollToBottom(processedMessages, client.userID);\n    var followOutput = function (isAtBottom) {\n        if (hasMoreNewer || suppressAutoscroll) {\n            return false;\n        }\n        if (shouldForceScrollToBottom()) {\n            return isAtBottom ? stickToBottomScrollBehavior : 'auto';\n        }\n        // a message from another user has been received - don't scroll to bottom unless already there\n        return isAtBottom ? stickToBottomScrollBehavior : false;\n    };\n    var messageRenderer = useCallback(function (messageList, virtuosoIndex, virtuosoContext) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        var lastReceivedMessageId = virtuosoContext.lastReceivedMessageId, ownMessagesReadByOthers = virtuosoContext.ownMessagesReadByOthers;\n        var streamMessageIndex = virtuosoIndex + numItemsPrepended - PREPEND_OFFSET;\n        // use custom renderer supplied by client if present and skip the rest\n        if (customMessageRenderer) {\n            return customMessageRenderer(messageList, streamMessageIndex);\n        }\n        var message = messageList[streamMessageIndex];\n        if (message.customType === CUSTOM_MESSAGE_TYPE.date && message.date && isDate(message.date)) {\n            return React.createElement(DateSeparator, { date: message.date, unread: message.unread });\n        }\n        if (!message)\n            return React.createElement(\"div\", { style: { height: '1px' } }); // returning null or zero height breaks the virtuoso\n        if (message.type === 'system') {\n            return React.createElement(MessageSystem, { message: message });\n        }\n        var groupedByUser = shouldGroupByUser &&\n            streamMessageIndex > 0 &&\n            ((_a = message.user) === null || _a === void 0 ? void 0 : _a.id) === ((_b = messageList[streamMessageIndex - 1].user) === null || _b === void 0 ? void 0 : _b.id);\n        var firstOfGroup = shouldGroupByUser && ((_c = message.user) === null || _c === void 0 ? void 0 : _c.id) !== ((_e = (_d = messageList[streamMessageIndex - 1]) === null || _d === void 0 ? void 0 : _d.user) === null || _e === void 0 ? void 0 : _e.id);\n        var endOfGroup = shouldGroupByUser && ((_f = message.user) === null || _f === void 0 ? void 0 : _f.id) !== ((_h = (_g = messageList[streamMessageIndex + 1]) === null || _g === void 0 ? void 0 : _g.user) === null || _h === void 0 ? void 0 : _h.id);\n        return (React.createElement(Message, { additionalMessageInputProps: props.additionalMessageInputProps, autoscrollToBottom: (_j = virtuoso.current) === null || _j === void 0 ? void 0 : _j.autoscrollToBottom, closeReactionSelectorOnClick: closeReactionSelectorOnClick, customMessageActions: props.customMessageActions, endOfGroup: endOfGroup, firstOfGroup: firstOfGroup, groupedByUser: groupedByUser, lastReceivedId: lastReceivedMessageId, message: message, Message: MessageUIComponent, messageActions: props.messageActions, readBy: ownMessagesReadByOthers[message.id] || [] }));\n    }, [customMessageRenderer, shouldGroupByUser, numItemsPrepended]);\n    var Item = useMemo(function () {\n        // using 'display: inline-block'\n        // traps CSS margins of the item elements, preventing incorrect item measurements\n        var Item = function (props) {\n            var _a;\n            var _b;\n            var context = props.context;\n            var streamMessageIndex = props['data-item-index'] + context.numItemsPrepended - PREPEND_OFFSET;\n            var message = context.processedMessages[streamMessageIndex];\n            var groupStyles = context.messageGroupStyles[message.id] || '';\n            return (React.createElement(\"div\", __assign({}, props, { className: ((_b = context === null || context === void 0 ? void 0 : context.customClasses) === null || _b === void 0 ? void 0 : _b.virtualMessage) ||\n                    clsx('str-chat__virtual-list-message-wrapper str-chat__li', (_a = {},\n                        _a[\"str-chat__li--\".concat(groupStyles)] = groupStyles,\n                        _a)) })));\n        };\n        return Item;\n    }, []);\n    var virtuosoComponents = useMemo(function () {\n        var EmptyPlaceholder = function () { return (React.createElement(React.Fragment, null, EmptyStateIndicator && (React.createElement(EmptyStateIndicator, { listType: threadList ? 'thread' : 'message' })))); };\n        var Header = function () {\n            return loadingMore ? (React.createElement(\"div\", { className: 'str-chat__virtual-list__loading' },\n                React.createElement(LoadingIndicator, { size: 20 }))) : (head || null);\n        };\n        var Footer = function () {\n            return TypingIndicator ? React.createElement(TypingIndicator, { avatarSize: 24 }) : React.createElement(React.Fragment, null);\n        };\n        return {\n            EmptyPlaceholder: EmptyPlaceholder,\n            Footer: Footer,\n            Header: Header,\n            Item: Item,\n        };\n    }, [loadingMore, head, Item]);\n    var atBottomStateChange = function (isAtBottom) {\n        atBottom.current = isAtBottom;\n        setIsMessageListScrolledToBottom(isAtBottom);\n        if (isAtBottom && newMessagesNotification) {\n            setNewMessagesNotification(false);\n        }\n    };\n    var startReached = function () {\n        if (hasMore && loadMore) {\n            loadMore(messageLimit);\n        }\n    };\n    var endReached = function () {\n        if (hasMoreNewer && loadMoreNewer) {\n            loadMoreNewer(messageLimit);\n        }\n    };\n    useEffect(function () {\n        var _a;\n        if (highlightedMessageId) {\n            var index = findMessageIndex(processedMessages, highlightedMessageId);\n            if (index !== -1) {\n                (_a = virtuoso.current) === null || _a === void 0 ? void 0 : _a.scrollToIndex({ align: 'center', index: index });\n            }\n        }\n    }, [highlightedMessageId]);\n    if (!processedMessages)\n        return null;\n    return (React.createElement(React.Fragment, null,\n        React.createElement(MessageListMainPanel, null,\n            React.createElement(\"div\", { className: (customClasses === null || customClasses === void 0 ? void 0 : customClasses.virtualizedMessageList) || 'str-chat__virtual-list' },\n                React.createElement(Virtuoso, __assign({ atBottomStateChange: atBottomStateChange, atBottomThreshold: 200, className: 'str-chat__message-list-scroll', components: virtuosoComponents, computeItemKey: function (index) {\n                        return processedMessages[numItemsPrepended + index - PREPEND_OFFSET].id;\n                    }, context: {\n                        customClasses: customClasses,\n                        lastReceivedMessageId: lastReceivedMessageId,\n                        messageGroupStyles: messageGroupStyles,\n                        numItemsPrepended: numItemsPrepended,\n                        ownMessagesReadByOthers: ownMessagesReadByOthers,\n                        processedMessages: processedMessages,\n                    }, endReached: endReached, firstItemIndex: PREPEND_OFFSET - numItemsPrepended, followOutput: followOutput, increaseViewportBy: { bottom: 200, top: 0 }, initialTopMostItemIndex: calculateInitialTopMostItemIndex(processedMessages, highlightedMessageId), itemContent: function (i, _, context) {\n                        return messageRenderer(processedMessages, i, context);\n                    }, itemSize: fractionalItemSize, key: messageSetKey, overscan: overscan, ref: virtuoso, startReached: startReached, style: { overflowX: 'hidden' }, totalCount: processedMessages.length }, additionalVirtuosoProps, (scrollSeekPlaceHolder ? { scrollSeek: scrollSeekPlaceHolder } : {}), (defaultItemHeight ? { defaultItemHeight: defaultItemHeight } : {}))))),\n        React.createElement(MessageListNotifications, { hasNewMessages: newMessagesNotification, isMessageListScrolledToBottom: isMessageListScrolledToBottom, isNotAtLatestMessageSet: hasMoreNewer, MessageNotification: MessageNotification, notifications: notifications, scrollToBottom: scrollToBottom, threadList: threadList }),\n        giphyPreviewMessage && React.createElement(GiphyPreviewMessage, { message: giphyPreviewMessage })));\n};\n/**\n * The VirtualizedMessageList component renders a list of messages in a virtualized list.\n * It is a consumer of the React contexts set in [Channel](https://github.com/GetStream/stream-chat-react/blob/master/src/components/Channel/Channel.tsx).\n */\nexport function VirtualizedMessageList(props) {\n    var _a = useChannelActionContext('VirtualizedMessageList'), jumpToLatestMessage = _a.jumpToLatestMessage, loadMore = _a.loadMore, loadMoreNewer = _a.loadMoreNewer;\n    var _b = useChannelStateContext('VirtualizedMessageList'), channel = _b.channel, hasMore = _b.hasMore, hasMoreNewer = _b.hasMoreNewer, highlightedMessageId = _b.highlightedMessageId, loadingMore = _b.loadingMore, loadingMoreNewer = _b.loadingMoreNewer, contextMessages = _b.messages, notifications = _b.notifications, read = _b.read, suppressAutoscroll = _b.suppressAutoscroll;\n    var messages = props.messages || contextMessages;\n    return (React.createElement(VirtualizedMessageListWithContext, __assign({ channel: channel, hasMore: !!hasMore, hasMoreNewer: !!hasMoreNewer, highlightedMessageId: highlightedMessageId, jumpToLatestMessage: jumpToLatestMessage, loadingMore: !!loadingMore, loadingMoreNewer: !!loadingMoreNewer, loadMore: loadMore, loadMoreNewer: loadMoreNewer, messages: messages, notifications: notifications, read: read, suppressAutoscroll: suppressAutoscroll }, props)));\n}\n"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AACxD,OAAOC,IAAI,MAAM,MAAM;AACvB,OAAOC,KAAK,IAAIC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAChF,SAASC,QAAQ,QAAS,gBAAgB;AAC1C,SAASC,mBAAmB,IAAIC,0BAA0B,QAAQ,uBAAuB;AACzF,SAASC,eAAe,QAAQ,yBAAyB;AACzD,SAASC,eAAe,EAAEC,yBAAyB,EAAEC,yBAAyB,EAAEC,4BAA4B,QAAS,SAAS;AAC9H,SAASC,mBAAmB,IAAIC,0BAA0B,QAAQ,uBAAuB;AACzF,SAASC,wBAAwB,IAAIC,+BAA+B,QAAQ,4BAA4B;AACxG,SAASC,oBAAoB,QAAQ,wBAAwB;AAC7D,SAASC,cAAc,EAAEC,eAAe,EAAEC,eAAe,QAAQ,SAAS;AAC1E,SAASC,mBAAmB,QAAQ,8BAA8B;AAClE,SAASC,aAAa,IAAIC,oBAAoB,QAAQ,gCAAgC;AACtF,SAASC,mBAAmB,IAAIC,0BAA0B,QAAQ,4CAA4C;AAC9G,SAASC,cAAc,QAAQ,kCAAkC;AACjE,SAASC,gBAAgB,IAAIC,uBAAuB,QAAQ,6BAA6B;AACzF,SAASC,OAAO,EAAEC,aAAa,QAAQ,YAAY;AACnD,SAASC,uBAAuB,QAAS,oCAAoC;AAC7E,SAASC,sBAAsB,QAAS,mCAAmC;AAC3E,SAASC,cAAc,QAAQ,2BAA2B;AAC1D,SAASC,mBAAmB,QAAQ,gCAAgC;AACpE,SAASC,MAAM,QAAQ,kCAAkC;AACzD,IAAIC,cAAc,GAAGC,IAAI,CAACC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC;AACpC,SAASC,kCAAkCA,CAACC,CAAC,EAAE;EAC3C,IAAIA,CAAC,CAACC,OAAO,KAAK,+DAA+D,IAC7ED,CAAC,CAACC,OAAO,KAAK,oCAAoC,EAAE;IACpDD,CAAC,CAACE,wBAAwB,CAAC,CAAC;EAChC;AACJ;AACA,SAASC,qCAAqCA,CAAA,EAAG;EAC7C1C,SAAS,CAAC,YAAY;IAClB2C,MAAM,CAACC,gBAAgB,CAAC,OAAO,EAAEN,kCAAkC,CAAC;IACpE,OAAO,YAAY;MACfK,MAAM,CAACE,mBAAmB,CAAC,OAAO,EAAEP,kCAAkC,CAAC;IAC3E,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;AACV;AACA,SAASQ,kBAAkBA,CAACC,OAAO,EAAE;EACjC,OAAOA,OAAO,CAACC,qBAAqB,CAAC,CAAC,CAACC,MAAM;AACjD;AACA,SAASC,gBAAgBA,CAACC,QAAQ,EAAEC,EAAE,EAAE;EACpC,OAAOD,QAAQ,CAACE,SAAS,CAAC,UAAUb,OAAO,EAAE;IAAE,OAAOA,OAAO,CAACY,EAAE,KAAKA,EAAE;EAAE,CAAC,CAAC;AAC/E;AACA,SAASE,gCAAgCA,CAACH,QAAQ,EAAEI,oBAAoB,EAAE;EACtE,IAAIA,oBAAoB,EAAE;IACtB,IAAIC,KAAK,GAAGN,gBAAgB,CAACC,QAAQ,EAAEI,oBAAoB,CAAC;IAC5D,IAAIC,KAAK,KAAK,CAAC,CAAC,EAAE;MACd,OAAO;QAAEC,KAAK,EAAE,QAAQ;QAAED,KAAK,EAAEA;MAAM,CAAC;IAC5C;EACJ;EACA,OAAOL,QAAQ,CAACO,MAAM,GAAG,CAAC;AAC9B;AACA,IAAIC,iCAAiC,GAAG,SAAAA,CAAUC,KAAK,EAAE;EACrD,IAAIC,uBAAuB,GAAGD,KAAK,CAACC,uBAAuB;IAAEC,OAAO,GAAGF,KAAK,CAACE,OAAO;IAAEC,4BAA4B,GAAGH,KAAK,CAACG,4BAA4B;IAAEC,qBAAqB,GAAGJ,KAAK,CAACI,qBAAqB;IAAEC,iBAAiB,GAAGL,KAAK,CAACK,iBAAiB;IAAEC,EAAE,GAAGN,KAAK,CAACO,oBAAoB;IAAEA,oBAAoB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,IAAI,GAAGA,EAAE;IAAEE,WAAW,GAAGR,KAAK,CAACQ,WAAW;IAAEC,OAAO,GAAGT,KAAK,CAACS,OAAO;IAAEC,YAAY,GAAGV,KAAK,CAACU,YAAY;IAAEC,IAAI,GAAGX,KAAK,CAACW,IAAI;IAAEC,EAAE,GAAGZ,KAAK,CAACa,mBAAmB;IAAEA,mBAAmB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IAAEE,EAAE,GAAGd,KAAK,CAACe,uBAAuB;IAAEA,uBAAuB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IAAEnB,oBAAoB,GAAGK,KAAK,CAACL,oBAAoB;IAAEqB,mBAAmB,GAAGhB,KAAK,CAACgB,mBAAmB;IAAEC,WAAW,GAAGjB,KAAK,CAACiB,WAAW;IAAEC,QAAQ,GAAGlB,KAAK,CAACkB,QAAQ;IAAEC,aAAa,GAAGnB,KAAK,CAACmB,aAAa;IAAEC,WAAW,GAAGpB,KAAK,CAAChC,OAAO;IAAEqD,EAAE,GAAGrB,KAAK,CAACsB,YAAY;IAAEA,YAAY,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,GAAG,GAAGA,EAAE;IAAE9B,QAAQ,GAAGS,KAAK,CAACT,QAAQ;IAAEgC,aAAa,GAAGvB,KAAK,CAACuB,aAAa;IAC58B;IACAC,EAAE,GAAGxB,KAAK,CAACyB,QAAQ;IACnB;IACAA,QAAQ,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,GAAGA,EAAE;IAAEE,IAAI,GAAG1B,KAAK,CAAC0B,IAAI;IAAEC,EAAE,GAAG3B,KAAK,CAAC4B,iBAAiB;IAAEA,iBAAiB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IAAEE,qBAAqB,GAAG7B,KAAK,CAAC6B,qBAAqB;IAAEC,EAAE,GAAG9B,KAAK,CAAC+B,4BAA4B;IAAEA,4BAA4B,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IAAEE,EAAE,GAAGhC,KAAK,CAACiC,oBAAoB;IAAEA,oBAAoB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IAAEE,EAAE,GAAGlC,KAAK,CAACmC,iBAAiB;IAAEA,iBAAiB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IAAEE,EAAE,GAAGpC,KAAK,CAACqC,2BAA2B;IAAEA,2BAA2B,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,QAAQ,GAAGA,EAAE;IAAEE,kBAAkB,GAAGtC,KAAK,CAACsC,kBAAkB;IAAEC,UAAU,GAAGvC,KAAK,CAACuC,UAAU;EAChnB;EACA;EACAzD,qCAAqC,CAAC,CAAC;EACvC,IAAI0D,EAAE,GAAGnE,mBAAmB,CAAC,wBAAwB,CAAC;IAAEoE,EAAE,GAAGD,EAAE,CAAC/E,aAAa;IAAEA,aAAa,GAAGgF,EAAE,KAAK,KAAK,CAAC,GAAG/E,oBAAoB,GAAG+E,EAAE;IAAEC,EAAE,GAAGF,EAAE,CAAC7E,mBAAmB;IAAEA,mBAAmB,GAAG+E,EAAE,KAAK,KAAK,CAAC,GAAG9E,0BAA0B,GAAG8E,EAAE;IAAEC,EAAE,GAAGH,EAAE,CAAC/F,mBAAmB;IAAEA,mBAAmB,GAAGkG,EAAE,KAAK,KAAK,CAAC,GAAGjG,0BAA0B,GAAGiG,EAAE;IAAEC,EAAE,GAAGJ,EAAE,CAAC1E,gBAAgB;IAAEA,gBAAgB,GAAG8E,EAAE,KAAK,KAAK,CAAC,GAAG7E,uBAAuB,GAAG6E,EAAE;IAAEC,EAAE,GAAGL,EAAE,CAACtF,wBAAwB;IAAEA,wBAAwB,GAAG2F,EAAE,KAAK,KAAK,CAAC,GAAG1F,+BAA+B,GAAG0F,EAAE;IAAEC,EAAE,GAAGN,EAAE,CAACxF,mBAAmB;IAAEA,mBAAmB,GAAG8F,EAAE,KAAK,KAAK,CAAC,GAAG7F,0BAA0B,GAAG6F,EAAE;IAAEC,EAAE,GAAGP,EAAE,CAACQ,aAAa;IAAEA,aAAa,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAGlF,cAAc,GAAGkF,EAAE;IAAEE,EAAE,GAAGT,EAAE,CAACU,eAAe;IAAEA,eAAe,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,IAAI,GAAGA,EAAE;IAAEE,EAAE,GAAGX,EAAE,CAACY,cAAc;IAAEC,cAAc,GAAGF,EAAE,KAAK,KAAK,CAAC,GAAGlF,aAAa,GAAGkF,EAAE;EACj2B,IAAIG,EAAE,GAAGlF,cAAc,CAAC,wBAAwB,CAAC;IAAEmF,MAAM,GAAGD,EAAE,CAACC,MAAM;IAAEC,aAAa,GAAGF,EAAE,CAACE,aAAa;EACvG,IAAIC,QAAQ,GAAGpH,OAAO,CAAC,YAAY;IAAE,IAAIiE,EAAE;IAAE,OAAO,CAACA,EAAE,GAAGJ,OAAO,CAACuD,QAAQ,MAAM,IAAI,IAAInD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACoD,IAAI,CAACxD,OAAO,CAAC;EAAE,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAChJ,IAAIyD,kBAAkB,GAAGvC,WAAW,IAAIiC,cAAc;EACtD,IAAIO,EAAE,GAAGjH,eAAe,CAACsF,oBAAoB,CAAC;IAAE4B,mBAAmB,GAAGD,EAAE,CAACC,mBAAmB;IAAEC,sBAAsB,GAAGF,EAAE,CAACE,sBAAsB;EAChJ,IAAIC,iBAAiB,GAAG1H,OAAO,CAAC,YAAY;IACxC,IAAI,OAAOkD,QAAQ,KAAK,WAAW,EAAE;MACjC,OAAO,EAAE;IACb;IACA,IAAIgB,oBAAoB,IACpB,CAACM,mBAAmB,IACpBE,uBAAuB,IACvB,CAACkB,oBAAoB,EAAE;MACvB,OAAO1C,QAAQ;IACnB;IACA,OAAOhC,eAAe,CAAC;MACnByG,mBAAmB,EAAE,CAACzD,oBAAoB;MAC1CM,mBAAmB,EAAEA,mBAAmB;MACxCE,uBAAuB,EAAEA,uBAAuB;MAChD0C,QAAQ,EAAEA,QAAQ;MAClBlE,QAAQ,EAAEA,QAAQ;MAClBuE,sBAAsB,EAAEA,sBAAsB;MAC9CG,MAAM,EAAEV,MAAM,CAACW,MAAM,IAAI;IAC7B,CAAC,CAAC;EACN,CAAC,EAAE,CACC3D,oBAAoB,EACpBM,mBAAmB,EACnBE,uBAAuB,EACvB0C,QAAQ,EACRlE,QAAQ,EACRA,QAAQ,KAAK,IAAI,IAAIA,QAAQ,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,QAAQ,CAACO,MAAM,EACnEyD,MAAM,CAACW,MAAM,CAChB,CAAC;EACF;EACA,IAAIC,uBAAuB,GAAGvH,eAAe,CAAC;IAC1C2C,QAAQ,EAAEwE,iBAAiB;IAC3BrC,IAAI,EAAEA,IAAI;IACVE,iBAAiB,EAAEA,iBAAiB;IACpCsC,MAAM,EAAEX,MAAM,CAACW;EACnB,CAAC,CAAC;EACF,IAAIE,qBAAqB,GAAG/H,OAAO,CAAC,YAAY;IAAE,OAAOiB,eAAe,CAACyG,iBAAiB,CAAC;EAAE,CAAC,EAAE,CAC5FA,iBAAiB,CACpB,CAAC;EACF,IAAIM,aAAa,GAAG7D,WAAW,IAAInD,cAAc;EACjD,IAAIiH,kBAAkB,GAAGjI,OAAO,CAAC,YAAY;IACzC,OAAO0H,iBAAiB,CAACQ,MAAM,CAAC,UAAUC,GAAG,EAAE5F,OAAO,EAAE6F,CAAC,EAAE;MACvD,IAAIC,KAAK,GAAGL,aAAa,CAACzF,OAAO,EAAEmF,iBAAiB,CAACU,CAAC,GAAG,CAAC,CAAC,EAAEV,iBAAiB,CAACU,CAAC,GAAG,CAAC,CAAC,EAAE,CAACtC,iBAAiB,CAAC;MAC1G,IAAIuC,KAAK,EACLF,GAAG,CAAC5F,OAAO,CAACY,EAAE,CAAC,GAAGkF,KAAK;MAC3B,OAAOF,GAAG;IACd,CAAC,EAAE,CAAC,CAAC,CAAC;EACV,CAAC;EACD;EACA,CAACT,iBAAiB,CAACjE,MAAM,EAAEqC,iBAAiB,CAAC,CAAC;EAC9C,IAAIwC,QAAQ,GAAGrI,MAAM,CAAC,IAAI,CAAC;EAC3B,IAAIsI,EAAE,GAAG/H,yBAAyB,CAACkH,iBAAiB,EAAER,MAAM,CAACW,MAAM,EAAExD,YAAY,CAAC;IAAEmE,QAAQ,GAAGD,EAAE,CAACC,QAAQ;IAAEC,6BAA6B,GAAGF,EAAE,CAACE,6BAA6B;IAAEC,uBAAuB,GAAGH,EAAE,CAACG,uBAAuB;IAAEC,gCAAgC,GAAGJ,EAAE,CAACI,gCAAgC;IAAEC,0BAA0B,GAAGL,EAAE,CAACK,0BAA0B;EACtW,IAAIC,cAAc,GAAG/I,WAAW,CAAC,YAAY;IAAE,OAAOJ,SAAS,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAChG,OAAOC,WAAW,CAAC,IAAI,EAAE,UAAUsE,EAAE,EAAE;QACnC,QAAQA,EAAE,CAAC6E,KAAK;UACZ,KAAK,CAAC;YACF,IAAI,CAACzE,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YAC1C,OAAO,CAAC,CAAC,CAAC,WAAWM,mBAAmB,CAAC,CAAC,CAAC;UAC/C,KAAK,CAAC;YACFV,EAAE,CAAC8E,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;UACzB,KAAK,CAAC;YACF,IAAIT,QAAQ,CAACU,OAAO,EAAE;cAClBV,QAAQ,CAACU,OAAO,CAACC,aAAa,CAACvB,iBAAiB,CAACjE,MAAM,GAAG,CAAC,CAAC;YAChE;YACAmF,0BAA0B,CAAC,KAAK,CAAC;YACjC,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EAAE,CAAC,EAAE,CACHN,QAAQ,EACRZ,iBAAiB,EACjBkB,0BAA0B;EAC1B;EACAlB,iBAAiB,CAACjE,MAAM,EACxBY,YAAY,EACZM,mBAAmB,CACtB,CAAC;EACF,IAAIuE,EAAE,GAAGrJ,KAAK,CAACK,QAAQ,CAAC,KAAK,CAAC;IAAEiJ,+BAA+B,GAAGD,EAAE,CAAC,CAAC,CAAC;IAAEE,kCAAkC,GAAGF,EAAE,CAAC,CAAC,CAAC;EACnH,IAAIG,oCAAoC,GAAGvJ,WAAW,CAAC,YAAY;IAC/DsJ,kCAAkC,CAAC,KAAK,CAAC;EAC7C,CAAC,EAAE,EAAE,CAAC;EACNrJ,SAAS,CAAC,YAAY;IAClBqJ,kCAAkC,CAAC,IAAI,CAAC;EAC5C,CAAC,EAAE,CAAClG,QAAQ,CAAC,CAAC;EACd,IAAIoG,0BAA0B,GAAGxJ,WAAW,CAAC,UAAUyJ,KAAK,EAAE;IAC1D,IAAI7D,4BAA4B,IAAI6D,KAAK,CAACC,MAAM,KAAK9G,MAAM,EAAE;MACzD,IAAIyG,+BAA+B,EAAE;QACjCM,UAAU,CAACZ,cAAc,EAAE,GAAG,CAAC;MACnC;IACJ;EACJ,CAAC,EAAE,CAACnD,4BAA4B,EAAEmD,cAAc,EAAEM,+BAA+B,CAAC,CAAC;EACnFpJ,SAAS,CAAC,YAAY;IAClB,IAAI,OAAO2C,MAAM,KAAK,WAAW,EAAE;MAC/BA,MAAM,CAACC,gBAAgB,CAAC,OAAO,EAAE2G,0BAA0B,CAAC;MAC5D5G,MAAM,CAACC,gBAAgB,CAAC,MAAM,EAAE0G,oCAAoC,CAAC;IACzE;IACA,OAAO,YAAY;MACf3G,MAAM,CAACE,mBAAmB,CAAC,OAAO,EAAE0G,0BAA0B,CAAC;MAC/D5G,MAAM,CAACE,mBAAmB,CAAC,MAAM,EAAEyG,oCAAoC,CAAC;IAC5E,CAAC;EACL,CAAC,EAAE,CAACC,0BAA0B,CAAC,CAAC;EAChC,IAAII,iBAAiB,GAAGjJ,yBAAyB,CAACiH,iBAAiB,EAAE,CAACxD,oBAAoB,CAAC;EAC3F;AACJ;AACA;EACI,IAAIyF,EAAE,GAAGzJ,QAAQ,CAAC,CAAC,IAAI0J,IAAI,CAAC,CAAC,CAAC;IAAEC,aAAa,GAAGF,EAAE,CAAC,CAAC,CAAC;IAAEG,gBAAgB,GAAGH,EAAE,CAAC,CAAC,CAAC;EAC/E,IAAII,cAAc,GAAG9J,MAAM,CAAC,CAAC;EAC7BF,SAAS,CAAC,YAAY;IAClB,IAAIkE,EAAE;IACN,IAAI+F,aAAa,GAAG9G,QAAQ,KAAK,IAAI,IAAIA,QAAQ,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,QAAQ,CAAC+G,IAAI,CAAC,UAAU1H,OAAO,EAAE;MAAE,OAAOA,OAAO,CAACY,EAAE,KAAK4G,cAAc,CAACf,OAAO;IAAE,CAAC,CAAC;IAC3J,IAAI,CAACgB,aAAa,EAAE;MAChBF,gBAAgB,CAAC,CAAC,IAAIF,IAAI,CAAC,CAAC,CAAC;IACjC;IACAG,cAAc,CAACf,OAAO,GAAG,CAAC/E,EAAE,GAAGf,QAAQ,KAAK,IAAI,IAAIA,QAAQ,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,QAAQ,CAAC,CAAC,CAAC,MAAM,IAAI,IAAIe,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACd,EAAE;EAC9I,CAAC,EAAE,CAACD,QAAQ,CAAC,CAAC;EACd,IAAIgH,yBAAyB,GAAGxJ,4BAA4B,CAACgH,iBAAiB,EAAER,MAAM,CAACW,MAAM,CAAC;EAC9F,IAAIsC,YAAY,GAAG,SAAAA,CAAUC,UAAU,EAAE;IACrC,IAAI/F,YAAY,IAAI4B,kBAAkB,EAAE;MACpC,OAAO,KAAK;IAChB;IACA,IAAIiE,yBAAyB,CAAC,CAAC,EAAE;MAC7B,OAAOE,UAAU,GAAGpE,2BAA2B,GAAG,MAAM;IAC5D;IACA;IACA,OAAOoE,UAAU,GAAGpE,2BAA2B,GAAG,KAAK;EAC3D,CAAC;EACD,IAAIqE,eAAe,GAAGvK,WAAW,CAAC,UAAUwK,WAAW,EAAEC,aAAa,EAAEC,eAAe,EAAE;IACrF,IAAIvG,EAAE,EAAEM,EAAE,EAAEE,EAAE,EAAEO,EAAE,EAAEG,EAAE,EAAEG,EAAE,EAAEG,EAAE,EAAEE,EAAE,EAAEE,EAAE;IACtC,IAAIkC,qBAAqB,GAAGyC,eAAe,CAACzC,qBAAqB;MAAED,uBAAuB,GAAG0C,eAAe,CAAC1C,uBAAuB;IACpI,IAAI2C,kBAAkB,GAAGF,aAAa,GAAGb,iBAAiB,GAAGxH,cAAc;IAC3E;IACA,IAAI6B,qBAAqB,EAAE;MACvB,OAAOA,qBAAqB,CAACuG,WAAW,EAAEG,kBAAkB,CAAC;IACjE;IACA,IAAIlI,OAAO,GAAG+H,WAAW,CAACG,kBAAkB,CAAC;IAC7C,IAAIlI,OAAO,CAACmI,UAAU,KAAKvJ,mBAAmB,CAACwJ,IAAI,IAAIpI,OAAO,CAACoI,IAAI,IAAI1I,MAAM,CAACM,OAAO,CAACoI,IAAI,CAAC,EAAE;MACzF,OAAO9K,KAAK,CAAC+K,aAAa,CAACxJ,aAAa,EAAE;QAAEuJ,IAAI,EAAEpI,OAAO,CAACoI,IAAI;QAAEE,MAAM,EAAEtI,OAAO,CAACsI;MAAO,CAAC,CAAC;IAC7F;IACA,IAAI,CAACtI,OAAO,EACR,OAAO1C,KAAK,CAAC+K,aAAa,CAAC,KAAK,EAAE;MAAEvC,KAAK,EAAE;QAAErF,MAAM,EAAE;MAAM;IAAE,CAAC,CAAC,CAAC,CAAC;IACrE,IAAIT,OAAO,CAACuI,IAAI,KAAK,QAAQ,EAAE;MAC3B,OAAOjL,KAAK,CAAC+K,aAAa,CAACjE,aAAa,EAAE;QAAEpE,OAAO,EAAEA;MAAQ,CAAC,CAAC;IACnE;IACA,IAAIwI,aAAa,GAAGjF,iBAAiB,IACjC2E,kBAAkB,GAAG,CAAC,IACtB,CAAC,CAACxG,EAAE,GAAG1B,OAAO,CAACyI,IAAI,MAAM,IAAI,IAAI/G,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACd,EAAE,OAAO,CAACoB,EAAE,GAAG+F,WAAW,CAACG,kBAAkB,GAAG,CAAC,CAAC,CAACO,IAAI,MAAM,IAAI,IAAIzG,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACpB,EAAE,CAAC;IACrK,IAAI8H,YAAY,GAAGnF,iBAAiB,IAAI,CAAC,CAACrB,EAAE,GAAGlC,OAAO,CAACyI,IAAI,MAAM,IAAI,IAAIvG,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACtB,EAAE,OAAO,CAACgC,EAAE,GAAG,CAACH,EAAE,GAAGsF,WAAW,CAACG,kBAAkB,GAAG,CAAC,CAAC,MAAM,IAAI,IAAIzF,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACgG,IAAI,MAAM,IAAI,IAAI7F,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAAChC,EAAE,CAAC;IACxP,IAAI+H,UAAU,GAAGpF,iBAAiB,IAAI,CAAC,CAACR,EAAE,GAAG/C,OAAO,CAACyI,IAAI,MAAM,IAAI,IAAI1F,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACnC,EAAE,OAAO,CAACwC,EAAE,GAAG,CAACF,EAAE,GAAG6E,WAAW,CAACG,kBAAkB,GAAG,CAAC,CAAC,MAAM,IAAI,IAAIhF,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACuF,IAAI,MAAM,IAAI,IAAIrF,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACxC,EAAE,CAAC;IACtP,OAAQtD,KAAK,CAAC+K,aAAa,CAACjJ,OAAO,EAAE;MAAEwJ,2BAA2B,EAAExH,KAAK,CAACwH,2BAA2B;MAAEC,kBAAkB,EAAE,CAACvF,EAAE,GAAGyC,QAAQ,CAACU,OAAO,MAAM,IAAI,IAAInD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACuF,kBAAkB;MAAEtH,4BAA4B,EAAEA,4BAA4B;MAAEuH,oBAAoB,EAAE1H,KAAK,CAAC0H,oBAAoB;MAAEH,UAAU,EAAEA,UAAU;MAAED,YAAY,EAAEA,YAAY;MAAEF,aAAa,EAAEA,aAAa;MAAEO,cAAc,EAAEvD,qBAAqB;MAAExF,OAAO,EAAEA,OAAO;MAAEZ,OAAO,EAAE2F,kBAAkB;MAAEiE,cAAc,EAAE5H,KAAK,CAAC4H,cAAc;MAAEC,MAAM,EAAE1D,uBAAuB,CAACvF,OAAO,CAACY,EAAE,CAAC,IAAI;IAAG,CAAC,CAAC;EACnkB,CAAC,EAAE,CAACY,qBAAqB,EAAE+B,iBAAiB,EAAE4D,iBAAiB,CAAC,CAAC;EACjE,IAAI+B,IAAI,GAAGzL,OAAO,CAAC,YAAY;IAC3B;IACA;IACA,IAAIyL,IAAI,GAAG,SAAAA,CAAU9H,KAAK,EAAE;MACxB,IAAIM,EAAE;MACN,IAAIM,EAAE;MACN,IAAImH,OAAO,GAAG/H,KAAK,CAAC+H,OAAO;MAC3B,IAAIjB,kBAAkB,GAAG9G,KAAK,CAAC,iBAAiB,CAAC,GAAG+H,OAAO,CAAChC,iBAAiB,GAAGxH,cAAc;MAC9F,IAAIK,OAAO,GAAGmJ,OAAO,CAAChE,iBAAiB,CAAC+C,kBAAkB,CAAC;MAC3D,IAAItG,WAAW,GAAGuH,OAAO,CAACzD,kBAAkB,CAAC1F,OAAO,CAACY,EAAE,CAAC,IAAI,EAAE;MAC9D,OAAQtD,KAAK,CAAC+K,aAAa,CAAC,KAAK,EAAEnL,QAAQ,CAAC,CAAC,CAAC,EAAEkE,KAAK,EAAE;QAAEgI,SAAS,EAAE,CAAC,CAACpH,EAAE,GAAGmH,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACvE,aAAa,MAAM,IAAI,IAAI5C,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACqH,cAAc,KAClMhM,IAAI,CAAC,qDAAqD,GAAGqE,EAAE,GAAG,CAAC,CAAC,EAChEA,EAAE,CAAC,gBAAgB,CAAC4H,MAAM,CAAC1H,WAAW,CAAC,CAAC,GAAGA,WAAW,EACtDF,EAAE,CAAC;MAAE,CAAC,CAAC,CAAC;IACxB,CAAC;IACD,OAAOwH,IAAI;EACf,CAAC,EAAE,EAAE,CAAC;EACN,IAAIK,kBAAkB,GAAG9L,OAAO,CAAC,YAAY;IACzC,IAAI+L,gBAAgB,GAAG,SAAAA,CAAA,EAAY;MAAE,OAAQlM,KAAK,CAAC+K,aAAa,CAAC/K,KAAK,CAACmM,QAAQ,EAAE,IAAI,EAAE1K,mBAAmB,IAAKzB,KAAK,CAAC+K,aAAa,CAACtJ,mBAAmB,EAAE;QAAE2K,QAAQ,EAAE/F,UAAU,GAAG,QAAQ,GAAG;MAAU,CAAC,CAAE,CAAC;IAAG,CAAC;IAC9M,IAAIgG,MAAM,GAAG,SAAAA,CAAA,EAAY;MACrB,OAAOtH,WAAW,GAAI/E,KAAK,CAAC+K,aAAa,CAAC,KAAK,EAAE;QAAEe,SAAS,EAAE;MAAkC,CAAC,EAC7F9L,KAAK,CAAC+K,aAAa,CAACnJ,gBAAgB,EAAE;QAAE0K,IAAI,EAAE;MAAG,CAAC,CAAC,CAAC,GAAK7H,IAAI,IAAI,IAAK;IAC9E,CAAC;IACD,IAAI8H,MAAM,GAAG,SAAAA,CAAA,EAAY;MACrB,OAAOvF,eAAe,GAAGhH,KAAK,CAAC+K,aAAa,CAAC/D,eAAe,EAAE;QAAEwF,UAAU,EAAE;MAAG,CAAC,CAAC,GAAGxM,KAAK,CAAC+K,aAAa,CAAC/K,KAAK,CAACmM,QAAQ,EAAE,IAAI,CAAC;IACjI,CAAC;IACD,OAAO;MACHD,gBAAgB,EAAEA,gBAAgB;MAClCK,MAAM,EAAEA,MAAM;MACdF,MAAM,EAAEA,MAAM;MACdT,IAAI,EAAEA;IACV,CAAC;EACL,CAAC,EAAE,CAAC7G,WAAW,EAAEN,IAAI,EAAEmH,IAAI,CAAC,CAAC;EAC7B,IAAIa,mBAAmB,GAAG,SAAAA,CAAUlC,UAAU,EAAE;IAC5C5B,QAAQ,CAACQ,OAAO,GAAGoB,UAAU;IAC7BzB,gCAAgC,CAACyB,UAAU,CAAC;IAC5C,IAAIA,UAAU,IAAI1B,uBAAuB,EAAE;MACvCE,0BAA0B,CAAC,KAAK,CAAC;IACrC;EACJ,CAAC;EACD,IAAI2D,YAAY,GAAG,SAAAA,CAAA,EAAY;IAC3B,IAAInI,OAAO,IAAIS,QAAQ,EAAE;MACrBA,QAAQ,CAACI,YAAY,CAAC;IAC1B;EACJ,CAAC;EACD,IAAIuH,UAAU,GAAG,SAAAA,CAAA,EAAY;IACzB,IAAInI,YAAY,IAAIS,aAAa,EAAE;MAC/BA,aAAa,CAACG,YAAY,CAAC;IAC/B;EACJ,CAAC;EACDlF,SAAS,CAAC,YAAY;IAClB,IAAIkE,EAAE;IACN,IAAIX,oBAAoB,EAAE;MACtB,IAAIC,KAAK,GAAGN,gBAAgB,CAACyE,iBAAiB,EAAEpE,oBAAoB,CAAC;MACrE,IAAIC,KAAK,KAAK,CAAC,CAAC,EAAE;QACd,CAACU,EAAE,GAAGqE,QAAQ,CAACU,OAAO,MAAM,IAAI,IAAI/E,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACgF,aAAa,CAAC;UAAEzF,KAAK,EAAE,QAAQ;UAAED,KAAK,EAAEA;QAAM,CAAC,CAAC;MACpH;IACJ;EACJ,CAAC,EAAE,CAACD,oBAAoB,CAAC,CAAC;EAC1B,IAAI,CAACoE,iBAAiB,EAClB,OAAO,IAAI;EACf,OAAQ7H,KAAK,CAAC+K,aAAa,CAAC/K,KAAK,CAACmM,QAAQ,EAAE,IAAI,EAC5CnM,KAAK,CAAC+K,aAAa,CAAC7J,oBAAoB,EAAE,IAAI,EAC1ClB,KAAK,CAAC+K,aAAa,CAAC,KAAK,EAAE;IAAEe,SAAS,EAAE,CAACxE,aAAa,KAAK,IAAI,IAAIA,aAAa,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,aAAa,CAACsF,sBAAsB,KAAK;EAAyB,CAAC,EACtK5M,KAAK,CAAC+K,aAAa,CAACzK,QAAQ,EAAEV,QAAQ,CAAC;IAAE6M,mBAAmB,EAAEA,mBAAmB;IAAEI,iBAAiB,EAAE,GAAG;IAAEf,SAAS,EAAE,+BAA+B;IAAEgB,UAAU,EAAEb,kBAAkB;IAAEc,cAAc,EAAE,SAAAA,CAAUrJ,KAAK,EAAE;MAChN,OAAOmE,iBAAiB,CAACgC,iBAAiB,GAAGnG,KAAK,GAAGrB,cAAc,CAAC,CAACiB,EAAE;IAC3E,CAAC;IAAEuI,OAAO,EAAE;MACRvE,aAAa,EAAEA,aAAa;MAC5BY,qBAAqB,EAAEA,qBAAqB;MAC5CE,kBAAkB,EAAEA,kBAAkB;MACtCyB,iBAAiB,EAAEA,iBAAiB;MACpC5B,uBAAuB,EAAEA,uBAAuB;MAChDJ,iBAAiB,EAAEA;IACvB,CAAC;IAAE8E,UAAU,EAAEA,UAAU;IAAEK,cAAc,EAAE3K,cAAc,GAAGwH,iBAAiB;IAAES,YAAY,EAAEA,YAAY;IAAE2C,kBAAkB,EAAE;MAAEC,MAAM,EAAE,GAAG;MAAEC,GAAG,EAAE;IAAE,CAAC;IAAEC,uBAAuB,EAAE5J,gCAAgC,CAACqE,iBAAiB,EAAEpE,oBAAoB,CAAC;IAAE4J,WAAW,EAAE,SAAAA,CAAU9E,CAAC,EAAE+E,CAAC,EAAEzB,OAAO,EAAE;MAC9R,OAAOrB,eAAe,CAAC3C,iBAAiB,EAAEU,CAAC,EAAEsD,OAAO,CAAC;IACzD,CAAC;IAAE0B,QAAQ,EAAEvK,kBAAkB;IAAEwK,GAAG,EAAExD,aAAa;IAAEzE,QAAQ,EAAEA,QAAQ;IAAEkI,GAAG,EAAEhF,QAAQ;IAAEiE,YAAY,EAAEA,YAAY;IAAElE,KAAK,EAAE;MAAEkF,SAAS,EAAE;IAAS,CAAC;IAAEC,UAAU,EAAE9F,iBAAiB,CAACjE;EAAO,CAAC,EAAEG,uBAAuB,EAAG4B,qBAAqB,GAAG;IAAEiI,UAAU,EAAEjI;EAAsB,CAAC,GAAG,CAAC,CAAC,EAAIxB,iBAAiB,GAAG;IAAEA,iBAAiB,EAAEA;EAAkB,CAAC,GAAG,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,EAC9WnE,KAAK,CAAC+K,aAAa,CAAC/J,wBAAwB,EAAE;IAAE6M,cAAc,EAAEhF,uBAAuB;IAAED,6BAA6B,EAAEA,6BAA6B;IAAEkF,uBAAuB,EAAEtJ,YAAY;IAAE1D,mBAAmB,EAAEA,mBAAmB;IAAEuE,aAAa,EAAEA,aAAa;IAAE2D,cAAc,EAAEA,cAAc;IAAE3C,UAAU,EAAEA;EAAW,CAAC,CAAC,EAC/TsB,mBAAmB,IAAI3H,KAAK,CAAC+K,aAAa,CAACxK,mBAAmB,EAAE;IAAEmC,OAAO,EAAEiF;EAAoB,CAAC,CAAC,CAAC;AAC1G,CAAC;AACD;AACA;AACA;AACA;AACA,OAAO,SAASoG,sBAAsBA,CAACjK,KAAK,EAAE;EAC1C,IAAIM,EAAE,GAAGpC,uBAAuB,CAAC,wBAAwB,CAAC;IAAE8C,mBAAmB,GAAGV,EAAE,CAACU,mBAAmB;IAAEE,QAAQ,GAAGZ,EAAE,CAACY,QAAQ;IAAEC,aAAa,GAAGb,EAAE,CAACa,aAAa;EAClK,IAAIP,EAAE,GAAGzC,sBAAsB,CAAC,wBAAwB,CAAC;IAAE+B,OAAO,GAAGU,EAAE,CAACV,OAAO;IAAEO,OAAO,GAAGG,EAAE,CAACH,OAAO;IAAEC,YAAY,GAAGE,EAAE,CAACF,YAAY;IAAEf,oBAAoB,GAAGiB,EAAE,CAACjB,oBAAoB;IAAEsB,WAAW,GAAGL,EAAE,CAACK,WAAW;IAAEiJ,gBAAgB,GAAGtJ,EAAE,CAACsJ,gBAAgB;IAAEC,eAAe,GAAGvJ,EAAE,CAACrB,QAAQ;IAAEgC,aAAa,GAAGX,EAAE,CAACW,aAAa;IAAEG,IAAI,GAAGd,EAAE,CAACc,IAAI;IAAEY,kBAAkB,GAAG1B,EAAE,CAAC0B,kBAAkB;EACxX,IAAI/C,QAAQ,GAAGS,KAAK,CAACT,QAAQ,IAAI4K,eAAe;EAChD,OAAQjO,KAAK,CAAC+K,aAAa,CAAClH,iCAAiC,EAAEjE,QAAQ,CAAC;IAAEoE,OAAO,EAAEA,OAAO;IAAEO,OAAO,EAAE,CAAC,CAACA,OAAO;IAAEC,YAAY,EAAE,CAAC,CAACA,YAAY;IAAEf,oBAAoB,EAAEA,oBAAoB;IAAEqB,mBAAmB,EAAEA,mBAAmB;IAAEC,WAAW,EAAE,CAAC,CAACA,WAAW;IAAEiJ,gBAAgB,EAAE,CAAC,CAACA,gBAAgB;IAAEhJ,QAAQ,EAAEA,QAAQ;IAAEC,aAAa,EAAEA,aAAa;IAAE5B,QAAQ,EAAEA,QAAQ;IAAEgC,aAAa,EAAEA,aAAa;IAAEG,IAAI,EAAEA,IAAI;IAAEY,kBAAkB,EAAEA;EAAmB,CAAC,EAAEtC,KAAK,CAAC,CAAC;AAC3c"},"metadata":{},"sourceType":"module","externalDependencies":[]}