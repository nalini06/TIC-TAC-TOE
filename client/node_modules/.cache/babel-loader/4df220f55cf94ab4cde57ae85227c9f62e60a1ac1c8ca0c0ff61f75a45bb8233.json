{"ast":null,"code":"import { __assign, __awaiter, __generator, __rest } from \"tslib\";\nimport React, { useEffect, useLayoutEffect, useMemo, useReducer, useRef, useState } from 'react';\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { logChatPromiseExecution } from 'stream-chat';\nimport { nanoid } from 'nanoid';\nimport clsx from 'clsx';\nimport { channelReducer, initialState } from './channelState';\nimport { commonEmoji, defaultMinimalEmojis, emojiSetDef } from './emojiData';\nimport { useCreateChannelStateContext } from './hooks/useCreateChannelStateContext';\nimport { useCreateTypingContext } from './hooks/useCreateTypingContext';\nimport { useEditMessageHandler } from './hooks/useEditMessageHandler';\nimport { useIsMounted } from './hooks/useIsMounted';\nimport { useMentionsHandlers } from './hooks/useMentionsHandlers';\nimport { Attachment as DefaultAttachment } from '../Attachment/Attachment';\nimport { LoadingErrorIndicator as DefaultLoadingErrorIndicator } from '../Loading';\nimport { LoadingChannel as DefaultLoadingIndicator } from './LoadingChannel';\nimport { MessageSimple } from '../Message/MessageSimple';\nimport { DropzoneProvider } from '../MessageInput/DropzoneProvider';\nimport { ChannelActionProvider } from '../../context/ChannelActionContext';\nimport { ChannelStateProvider } from '../../context/ChannelStateContext';\nimport { ComponentProvider } from '../../context/ComponentContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { EmojiProvider } from '../../context/EmojiContext';\nimport { useTranslationContext } from '../../context/TranslationContext';\nimport { TypingProvider } from '../../context/TypingContext';\nimport { DEFAULT_INITIAL_CHANNEL_PAGE_SIZE, DEFAULT_NEXT_CHANNEL_PAGE_SIZE, DEFAULT_THREAD_PAGE_SIZE } from '../../constants/limits';\nimport { hasMoreMessagesProbably, hasNotMoreMessages } from '../MessageList/utils';\nimport defaultEmojiData from '../../stream-emoji.json';\nimport { makeAddNotifications } from './utils';\nimport { getChannel } from '../../utils/getChannel';\nimport { useChannelContainerClasses } from './hooks/useChannelContainerClasses';\nimport { getImageAttachmentConfiguration, getVideoAttachmentConfiguration } from '../Attachment/attachment-sizing';\nvar UnMemoizedChannel = function (props) {\n  var propsChannel = props.channel,\n    _a = props.EmptyPlaceholder,\n    EmptyPlaceholder = _a === void 0 ? null : _a,\n    LoadingErrorIndicator = props.LoadingErrorIndicator,\n    _b = props.LoadingIndicator,\n    LoadingIndicator = _b === void 0 ? DefaultLoadingIndicator : _b;\n  var _c = useChatContext('Channel'),\n    contextChannel = _c.channel,\n    channelsQueryState = _c.channelsQueryState,\n    customClasses = _c.customClasses,\n    theme = _c.theme;\n  var _d = useChannelContainerClasses({\n      customClasses: customClasses\n    }),\n    channelClass = _d.channelClass,\n    chatClass = _d.chatClass;\n  var channel = propsChannel || contextChannel;\n  var className = clsx(chatClass, theme, channelClass);\n  if (channelsQueryState.queryInProgress === 'reload' && LoadingIndicator) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingIndicator, null));\n  }\n  if (channelsQueryState.error && LoadingErrorIndicator) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingErrorIndicator, {\n      error: channelsQueryState.error\n    }));\n  }\n  if (!(channel === null || channel === void 0 ? void 0 : channel.cid)) {\n    return React.createElement(\"div\", {\n      className: className\n    }, EmptyPlaceholder);\n  }\n  // @ts-ignore\n  return React.createElement(ChannelInner, __assign({}, props, {\n    channel: channel,\n    key: channel.cid\n  }));\n};\nvar ChannelInner = function (props) {\n  var _a;\n  var acceptedFiles = props.acceptedFiles,\n    activeUnreadHandler = props.activeUnreadHandler,\n    channel = props.channel,\n    children = props.children,\n    doMarkReadRequest = props.doMarkReadRequest,\n    doSendMessageRequest = props.doSendMessageRequest,\n    doUpdateMessageRequest = props.doUpdateMessageRequest,\n    _b = props.dragAndDropWindow,\n    dragAndDropWindow = _b === void 0 ? false : _b,\n    _c = props.emojiData,\n    emojiData = _c === void 0 ? defaultEmojiData : _c,\n    enrichURLForPreviewConfig = props.enrichURLForPreviewConfig,\n    _d = props.LoadingErrorIndicator,\n    LoadingErrorIndicator = _d === void 0 ? DefaultLoadingErrorIndicator : _d,\n    _e = props.LoadingIndicator,\n    LoadingIndicator = _e === void 0 ? DefaultLoadingIndicator : _e,\n    maxNumberOfFiles = props.maxNumberOfFiles,\n    _f = props.multipleUploads,\n    multipleUploads = _f === void 0 ? true : _f,\n    onMentionsClick = props.onMentionsClick,\n    onMentionsHover = props.onMentionsHover,\n    _g = props.optionalMessageInputProps,\n    optionalMessageInputProps = _g === void 0 ? {} : _g,\n    skipMessageDataMemoization = props.skipMessageDataMemoization;\n  var _h = useChatContext('Channel'),\n    client = _h.client,\n    customClasses = _h.customClasses,\n    latestMessageDatesByChannels = _h.latestMessageDatesByChannels,\n    mutes = _h.mutes,\n    theme = _h.theme;\n  var t = useTranslationContext('Channel').t;\n  var _j = useChannelContainerClasses({\n      customClasses: customClasses\n    }),\n    channelClass = _j.channelClass,\n    chatClass = _j.chatClass,\n    chatContainerClass = _j.chatContainerClass,\n    windowsEmojiClass = _j.windowsEmojiClass;\n  var _k = useState(channel.getConfig()),\n    channelConfig = _k[0],\n    setChannelConfig = _k[1];\n  var _l = useState([]),\n    notifications = _l[0],\n    setNotifications = _l[1];\n  var _m = useState(),\n    quotedMessage = _m[0],\n    setQuotedMessage = _m[1];\n  var notificationTimeouts = [];\n  var _o = useReducer(channelReducer, __assign(__assign({}, initialState), {\n      loading: !channel.initialized\n    })),\n    state = _o[0],\n    dispatch = _o[1];\n  var isMounted = useIsMounted();\n  var originalTitle = useRef('');\n  var lastRead = useRef(new Date());\n  var online = useRef(true);\n  var channelCapabilitiesArray = (_a = channel.data) === null || _a === void 0 ? void 0 : _a.own_capabilities;\n  var emojiConfig = {\n    commonEmoji: commonEmoji,\n    defaultMinimalEmojis: defaultMinimalEmojis,\n    emojiData: emojiData,\n    emojiSetDef: emojiSetDef\n  };\n  var throttledCopyStateFromChannel = throttle(function () {\n    return dispatch({\n      channel: channel,\n      type: 'copyStateFromChannelOnEvent'\n    });\n  }, 500, {\n    leading: true,\n    trailing: true\n  });\n  var markRead = function () {\n    if (channel.disconnected || !(channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events)) {\n      return;\n    }\n    lastRead.current = new Date();\n    if (doMarkReadRequest) {\n      doMarkReadRequest(channel);\n    } else {\n      logChatPromiseExecution(channel.markRead(), 'mark read');\n    }\n    if (activeUnreadHandler) {\n      activeUnreadHandler(0, originalTitle.current);\n    } else if (originalTitle.current) {\n      document.title = originalTitle.current;\n    }\n  };\n  var markReadThrottled = throttle(markRead, 500, {\n    leading: true,\n    trailing: true\n  });\n  var handleEvent = function (event) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var mainChannelUpdated, unread, messageDate, cid, oldestID;\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;\n      return __generator(this, function (_m) {\n        switch (_m.label) {\n          case 0:\n            if (event.message) {\n              dispatch({\n                channel: channel,\n                message: event.message,\n                type: 'updateThreadOnEvent'\n              });\n            }\n            if (event.type === 'user.watching.start' || event.type === 'user.watching.stop') return [2 /*return*/];\n            if (event.type === 'typing.start' || event.type === 'typing.stop') {\n              return [2 /*return*/, dispatch({\n                channel: channel,\n                type: 'setTyping'\n              })];\n            }\n            if (event.type === 'connection.changed' && typeof event.online === 'boolean') {\n              online.current = event.online;\n            }\n            if (event.type === 'message.new') {\n              mainChannelUpdated = true;\n              if (((_a = event.message) === null || _a === void 0 ? void 0 : _a.parent_id) && !((_b = event.message) === null || _b === void 0 ? void 0 : _b.show_in_channel)) {\n                mainChannelUpdated = false;\n              }\n              if (mainChannelUpdated && ((_d = (_c = event.message) === null || _c === void 0 ? void 0 : _c.user) === null || _d === void 0 ? void 0 : _d.id) !== client.userID) {\n                if (!document.hidden) {\n                  markReadThrottled();\n                } else if ((channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events) && !channel.muteStatus().muted) {\n                  unread = channel.countUnread(lastRead.current);\n                  if (activeUnreadHandler) {\n                    activeUnreadHandler(unread, originalTitle.current);\n                  } else {\n                    document.title = \"(\".concat(unread, \") \").concat(originalTitle.current);\n                  }\n                }\n              }\n              if (((_f = (_e = event.message) === null || _e === void 0 ? void 0 : _e.user) === null || _f === void 0 ? void 0 : _f.id) === client.userID && ((_g = event === null || event === void 0 ? void 0 : event.message) === null || _g === void 0 ? void 0 : _g.created_at) && ((_h = event === null || event === void 0 ? void 0 : event.message) === null || _h === void 0 ? void 0 : _h.cid)) {\n                messageDate = new Date(event.message.created_at);\n                cid = event.message.cid;\n                if (!latestMessageDatesByChannels[cid] || latestMessageDatesByChannels[cid].getTime() < messageDate.getTime()) {\n                  latestMessageDatesByChannels[cid] = messageDate;\n                }\n              }\n            }\n            if (!(event.type === 'user.deleted')) return [3 /*break*/, 2];\n            oldestID = (_l = (_k = (_j = channel.state) === null || _j === void 0 ? void 0 : _j.messages) === null || _k === void 0 ? void 0 : _k[0]) === null || _l === void 0 ? void 0 : _l.id;\n            /**\n             * As the channel state is not normalized we re-fetch the channel data. Thus, we avoid having to search for user references in the channel state.\n             */\n            return [4 /*yield*/, channel.query({\n              messages: {\n                id_lt: oldestID,\n                limit: DEFAULT_NEXT_CHANNEL_PAGE_SIZE\n              },\n              watchers: {\n                limit: DEFAULT_NEXT_CHANNEL_PAGE_SIZE\n              }\n            })];\n          case 1:\n            /**\n             * As the channel state is not normalized we re-fetch the channel data. Thus, we avoid having to search for user references in the channel state.\n             */\n            _m.sent();\n            _m.label = 2;\n          case 2:\n            throttledCopyStateFromChannel();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  // useLayoutEffect here to prevent spinner. Use Suspense when it is available in stable release\n  useLayoutEffect(function () {\n    var errored = false;\n    var done = false;\n    var onVisibilityChange = function () {\n      if (!document.hidden) markRead();\n    };\n    (function () {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var members, _i, _a, member, userId, _b, user, user_id, config, e_1;\n        var _c;\n        return __generator(this, function (_d) {\n          switch (_d.label) {\n            case 0:\n              if (!!channel.initialized) return [3 /*break*/, 4];\n              _d.label = 1;\n            case 1:\n              _d.trys.push([1, 3,, 4]);\n              members = [];\n              if (!channel.id && ((_c = channel.data) === null || _c === void 0 ? void 0 : _c.members)) {\n                for (_i = 0, _a = channel.data.members; _i < _a.length; _i++) {\n                  member = _a[_i];\n                  userId = void 0;\n                  if (typeof member === 'string') {\n                    userId = member;\n                  } else if (typeof member === 'object') {\n                    _b = member, user = _b.user, user_id = _b.user_id;\n                    userId = user_id || (user === null || user === void 0 ? void 0 : user.id);\n                  }\n                  if (userId) {\n                    members.push(userId);\n                  }\n                }\n              }\n              return [4 /*yield*/, getChannel({\n                channel: channel,\n                client: client,\n                members: members\n              })];\n            case 2:\n              _d.sent();\n              config = channel.getConfig();\n              setChannelConfig(config);\n              return [3 /*break*/, 4];\n            case 3:\n              e_1 = _d.sent();\n              dispatch({\n                error: e_1,\n                type: 'setError'\n              });\n              errored = true;\n              return [3 /*break*/, 4];\n            case 4:\n              done = true;\n              originalTitle.current = document.title;\n              if (!errored) {\n                dispatch({\n                  channel: channel,\n                  type: 'initStateFromChannel'\n                });\n                if (channel.countUnread() > 0) markRead();\n                // The more complex sync logic is done in Chat\n                document.addEventListener('visibilitychange', onVisibilityChange);\n                client.on('connection.changed', handleEvent);\n                client.on('connection.recovered', handleEvent);\n                client.on('user.updated', handleEvent);\n                client.on('user.deleted', handleEvent);\n                channel.on(handleEvent);\n              }\n              return [2 /*return*/];\n          }\n        });\n      });\n    })();\n\n    return function () {\n      if (errored || !done) return;\n      document.removeEventListener('visibilitychange', onVisibilityChange);\n      channel === null || channel === void 0 ? void 0 : channel.off(handleEvent);\n      client.off('connection.changed', handleEvent);\n      client.off('connection.recovered', handleEvent);\n      client.off('user.updated', handleEvent);\n      client.off('user.deleted', handleEvent);\n      notificationTimeouts.forEach(clearTimeout);\n    };\n  }, [channel.cid, doMarkReadRequest, channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events]);\n  useEffect(function () {\n    var _a;\n    if (!state.thread) return;\n    var message = (_a = state.messages) === null || _a === void 0 ? void 0 : _a.find(function (m) {\n      var _a;\n      return m.id === ((_a = state.thread) === null || _a === void 0 ? void 0 : _a.id);\n    });\n    if (message) dispatch({\n      message: message,\n      type: 'setThread'\n    });\n  }, [state.messages, state.thread]);\n  /** MESSAGE */\n  // Adds a temporary notification to message list, will be removed after 5 seconds\n  var addNotification = makeAddNotifications(setNotifications, notificationTimeouts);\n  var loadMoreFinished = debounce(function (hasMore, messages) {\n    if (!isMounted.current) return;\n    dispatch({\n      hasMore: hasMore,\n      messages: messages,\n      type: 'loadMoreFinished'\n    });\n  }, 2000, {\n    leading: true,\n    trailing: true\n  });\n  var loadMore = function (limit) {\n    if (limit === void 0) {\n      limit = DEFAULT_NEXT_CHANNEL_PAGE_SIZE;\n    }\n    return __awaiter(void 0, void 0, void 0, function () {\n      var oldestMessage, notHasMore, oldestID, perPage, queryResponse, e_2, hasMoreMessages;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!online.current || !window.navigator.onLine) return [2 /*return*/, 0];\n            oldestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[0];\n            if (state.loadingMore || state.loadingMoreNewer || (oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.status) !== 'received') {\n              return [2 /*return*/, 0];\n            }\n            notHasMore = hasNotMoreMessages(channel.state.messages.length, DEFAULT_INITIAL_CHANNEL_PAGE_SIZE);\n            if (notHasMore) {\n              loadMoreFinished(false, channel.state.messages);\n              return [2 /*return*/, channel.state.messages.length];\n            }\n            dispatch({\n              loadingMore: true,\n              type: 'setLoadingMore'\n            });\n            oldestID = oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.id;\n            perPage = limit;\n            _b.label = 1;\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, channel.query({\n              messages: {\n                id_lt: oldestID,\n                limit: perPage\n              },\n              watchers: {\n                limit: perPage\n              }\n            })];\n          case 2:\n            queryResponse = _b.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            e_2 = _b.sent();\n            console.warn('message pagination request failed with error', e_2);\n            dispatch({\n              loadingMore: false,\n              type: 'setLoadingMore'\n            });\n            return [2 /*return*/, 0];\n          case 4:\n            hasMoreMessages = queryResponse.messages.length === perPage;\n            loadMoreFinished(hasMoreMessages, channel.state.messages);\n            return [2 /*return*/, queryResponse.messages.length];\n        }\n      });\n    });\n  };\n  var loadMoreNewer = function (limit) {\n    if (limit === void 0) {\n      limit = 100;\n    }\n    return __awaiter(void 0, void 0, void 0, function () {\n      var newestMessage, newestId, perPage, queryResponse, e_3, hasMoreNewer;\n      var _a, _b;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (!online.current || !window.navigator.onLine) return [2 /*return*/, 0];\n            newestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[((_b = state === null || state === void 0 ? void 0 : state.messages) === null || _b === void 0 ? void 0 : _b.length) - 1];\n            if (state.loadingMore || state.loadingMoreNewer) return [2 /*return*/, 0];\n            dispatch({\n              loadingMoreNewer: true,\n              type: 'setLoadingMoreNewer'\n            });\n            newestId = newestMessage === null || newestMessage === void 0 ? void 0 : newestMessage.id;\n            perPage = limit;\n            _c.label = 1;\n          case 1:\n            _c.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, channel.query({\n              messages: {\n                id_gt: newestId,\n                limit: perPage\n              },\n              watchers: {\n                limit: perPage\n              }\n            })];\n          case 2:\n            queryResponse = _c.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            e_3 = _c.sent();\n            console.warn('message pagination request failed with error', e_3);\n            dispatch({\n              loadingMoreNewer: false,\n              type: 'setLoadingMoreNewer'\n            });\n            return [2 /*return*/, 0];\n          case 4:\n            hasMoreNewer = channel.state.messages !== channel.state.latestMessages;\n            dispatch({\n              hasMoreNewer: hasMoreNewer,\n              messages: channel.state.messages,\n              type: 'loadMoreNewerFinished'\n            });\n            return [2 /*return*/, queryResponse.messages.length];\n        }\n      });\n    });\n  };\n  var clearHighlightedMessageTimeoutId = useRef(null);\n  var jumpToMessage = function (messageId, messageLimit) {\n    if (messageLimit === void 0) {\n      messageLimit = 100;\n    }\n    return __awaiter(void 0, void 0, void 0, function () {\n      var indexOfMessage, hasMoreMessages;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            dispatch({\n              loadingMore: true,\n              type: 'setLoadingMore'\n            });\n            return [4 /*yield*/, channel.state.loadMessageIntoState(messageId, undefined, messageLimit)];\n          case 1:\n            _a.sent();\n            indexOfMessage = channel.state.messages.findIndex(function (message) {\n              return message.id === messageId;\n            });\n            hasMoreMessages = indexOfMessage >= Math.floor(messageLimit / 2);\n            loadMoreFinished(hasMoreMessages, channel.state.messages);\n            dispatch({\n              hasMoreNewer: channel.state.messages !== channel.state.latestMessages,\n              highlightedMessageId: messageId,\n              type: 'jumpToMessageFinished'\n            });\n            if (clearHighlightedMessageTimeoutId.current) {\n              clearTimeout(clearHighlightedMessageTimeoutId.current);\n            }\n            clearHighlightedMessageTimeoutId.current = setTimeout(function () {\n              clearHighlightedMessageTimeoutId.current = null;\n              dispatch({\n                type: 'clearHighlightedMessage'\n              });\n            }, 500);\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var jumpToLatestMessage = function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var hasMoreOlder;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, channel.state.loadMessageIntoState('latest')];\n          case 1:\n            _a.sent();\n            hasMoreOlder = channel.state.messages.length >= 25;\n            loadMoreFinished(hasMoreOlder, channel.state.messages);\n            dispatch({\n              type: 'jumpToLatestMessage'\n            });\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var updateMessage = function (updatedMessage) {\n    // add the message to the local channel state\n    channel.state.addMessageSorted(updatedMessage, true);\n    dispatch({\n      channel: channel,\n      parentId: state.thread && updatedMessage.parent_id,\n      type: 'copyMessagesFromChannel'\n    });\n  };\n  var isUserResponseArray = function (output) {\n    var _a;\n    return ((_a = output[0]) === null || _a === void 0 ? void 0 : _a.id) != null;\n  };\n  var doSendMessage = function (message, customMessageData, options) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var attachments, id, _a, mentioned_users, parent_id, text, mentions, messageData, messageResponse, existingMessage, i, msg, responseTimestamp, existingMessageTimestamp, responseIsTheNewest, error_1, stringError, parsedError;\n      var _b, _c;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            attachments = message.attachments, id = message.id, _a = message.mentioned_users, mentioned_users = _a === void 0 ? [] : _a, parent_id = message.parent_id, text = message.text;\n            mentions = isUserResponseArray(mentioned_users) ? mentioned_users.map(function (_a) {\n              var id = _a.id;\n              return id;\n            }) : mentioned_users;\n            messageData = __assign({\n              attachments: attachments,\n              id: id,\n              mentioned_users: mentions,\n              parent_id: parent_id,\n              quoted_message_id: parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id) ? quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.id : undefined,\n              text: text\n            }, customMessageData);\n            _d.label = 1;\n          case 1:\n            _d.trys.push([1, 6,, 7]);\n            messageResponse = void 0;\n            if (!doSendMessageRequest) return [3 /*break*/, 3];\n            return [4 /*yield*/, doSendMessageRequest(channel.cid, messageData, options)];\n          case 2:\n            messageResponse = _d.sent();\n            return [3 /*break*/, 5];\n          case 3:\n            return [4 /*yield*/, channel.sendMessage(messageData, options)];\n          case 4:\n            messageResponse = _d.sent();\n            _d.label = 5;\n          case 5:\n            existingMessage = void 0;\n            for (i = channel.state.messages.length - 1; i >= 0; i--) {\n              msg = channel.state.messages[i];\n              if (msg.id === messageData.id) {\n                existingMessage = msg;\n                break;\n              }\n            }\n            responseTimestamp = new Date(((_b = messageResponse === null || messageResponse === void 0 ? void 0 : messageResponse.message) === null || _b === void 0 ? void 0 : _b.updated_at) || 0).getTime();\n            existingMessageTimestamp = ((_c = existingMessage === null || existingMessage === void 0 ? void 0 : existingMessage.updated_at) === null || _c === void 0 ? void 0 : _c.getTime()) || 0;\n            responseIsTheNewest = responseTimestamp > existingMessageTimestamp;\n            // Replace the message payload after send is completed\n            // We need to check for the newest message payload, because on slow network, the response can arrive later than WS events message.new, message.updated.\n            // Always override existing message in status \"sending\"\n            if ((messageResponse === null || messageResponse === void 0 ? void 0 : messageResponse.message) && (responseIsTheNewest || (existingMessage === null || existingMessage === void 0 ? void 0 : existingMessage.status) === 'sending')) {\n              updateMessage(__assign(__assign({}, messageResponse.message), {\n                status: 'received'\n              }));\n            }\n            if (quotedMessage && parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id)) setQuotedMessage(undefined);\n            return [3 /*break*/, 7];\n          case 6:\n            error_1 = _d.sent();\n            stringError = JSON.stringify(error_1);\n            parsedError = stringError ? JSON.parse(stringError) : {};\n            updateMessage(__assign(__assign({}, message), {\n              error: parsedError,\n              errorStatusCode: parsedError.status || undefined,\n              status: 'failed'\n            }));\n            return [3 /*break*/, 7];\n          case 7:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var sendMessage = function (_a, customMessageData, options) {\n    var _b = _a.attachments,\n      attachments = _b === void 0 ? [] : _b,\n      _c = _a.mentioned_users,\n      mentioned_users = _c === void 0 ? [] : _c,\n      parent = _a.parent,\n      _d = _a.text,\n      text = _d === void 0 ? '' : _d;\n    return __awaiter(void 0, void 0, void 0, function () {\n      var messagePreview;\n      var _e;\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            channel.state.filterErrorMessages();\n            messagePreview = __assign({\n              __html: text,\n              attachments: attachments,\n              created_at: new Date(),\n              html: text,\n              id: (_e = customMessageData === null || customMessageData === void 0 ? void 0 : customMessageData.id) !== null && _e !== void 0 ? _e : \"\".concat(client.userID, \"-\").concat(nanoid()),\n              mentioned_users: mentioned_users,\n              reactions: [],\n              status: 'sending',\n              text: text,\n              type: 'regular',\n              user: client.user\n            }, (parent === null || parent === void 0 ? void 0 : parent.id) ? {\n              parent_id: parent.id\n            } : null);\n            updateMessage(messagePreview);\n            return [4 /*yield*/, doSendMessage(messagePreview, customMessageData, options)];\n          case 1:\n            _f.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var retrySendMessage = function (message) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            updateMessage(__assign(__assign({}, message), {\n              errorStatusCode: undefined,\n              status: 'sending'\n            }));\n            if (message.attachments) {\n              // remove scraped attachments added during the message composition in MessageInput to prevent sync issues\n              message.attachments = message.attachments.filter(function (attachment) {\n                return !attachment.og_scrape_url;\n              });\n            }\n            return [4 /*yield*/, doSendMessage(message)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var removeMessage = function (message) {\n    channel.state.removeMessage(message);\n    dispatch({\n      channel: channel,\n      parentId: state.thread && message.parent_id,\n      type: 'copyMessagesFromChannel'\n    });\n  };\n  /** THREAD */\n  var openThread = function (message, event) {\n    event === null || event === void 0 ? void 0 : event.preventDefault();\n    setQuotedMessage(function (current) {\n      if ((current === null || current === void 0 ? void 0 : current.parent_id) !== (message === null || message === void 0 ? void 0 : message.parent_id)) {\n        return undefined;\n      } else {\n        return current;\n      }\n    });\n    dispatch({\n      channel: channel,\n      message: message,\n      type: 'openThread'\n    });\n  };\n  var closeThread = function (event) {\n    event === null || event === void 0 ? void 0 : event.preventDefault();\n    dispatch({\n      type: 'closeThread'\n    });\n  };\n  var loadMoreThreadFinished = debounce(function (threadHasMore, threadMessages) {\n    dispatch({\n      threadHasMore: threadHasMore,\n      threadMessages: threadMessages,\n      type: 'loadMoreThreadFinished'\n    });\n  }, 2000, {\n    leading: true,\n    trailing: true\n  });\n  var loadMoreThread = function (limit) {\n    if (limit === void 0) {\n      limit = DEFAULT_THREAD_PAGE_SIZE;\n    }\n    return __awaiter(void 0, void 0, void 0, function () {\n      var parentID, oldMessages, oldestMessageID, queryResponse, threadHasMoreMessages, newThreadMessages, e_4;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (state.threadLoadingMore || !state.thread) return [2 /*return*/];\n            dispatch({\n              type: 'startLoadingThread'\n            });\n            parentID = state.thread.id;\n            if (!parentID) {\n              return [2 /*return*/, dispatch({\n                type: 'closeThread'\n              })];\n            }\n            oldMessages = channel.state.threads[parentID] || [];\n            oldestMessageID = (_a = oldMessages[0]) === null || _a === void 0 ? void 0 : _a.id;\n            _b.label = 1;\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, channel.getReplies(parentID, {\n              id_lt: oldestMessageID,\n              limit: limit\n            })];\n          case 2:\n            queryResponse = _b.sent();\n            threadHasMoreMessages = hasMoreMessagesProbably(queryResponse.messages.length, limit);\n            newThreadMessages = channel.state.threads[parentID] || [];\n            // next set loadingMore to false so we can start asking for more data\n            loadMoreThreadFinished(threadHasMoreMessages, newThreadMessages);\n            return [3 /*break*/, 4];\n          case 3:\n            e_4 = _b.sent();\n            loadMoreThreadFinished(false, oldMessages);\n            return [3 /*break*/, 4];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var onMentionsHoverOrClick = useMentionsHandlers(onMentionsHover, onMentionsClick);\n  var editMessage = useEditMessageHandler(doUpdateMessageRequest);\n  var typing = state.typing,\n    restState = __rest(state, [\"typing\"]);\n  var channelStateContextValue = useCreateChannelStateContext(__assign(__assign({}, restState), {\n    acceptedFiles: acceptedFiles,\n    channel: channel,\n    channelCapabilitiesArray: channelCapabilitiesArray,\n    channelConfig: channelConfig,\n    debounceURLEnrichmentMs: enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.debounceURLEnrichmentMs,\n    dragAndDropWindow: dragAndDropWindow,\n    enrichURLForPreview: props.enrichURLForPreview,\n    findURLFn: enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.findURLFn,\n    giphyVersion: props.giphyVersion || 'fixed_height',\n    imageAttachmentSizeHandler: props.imageAttachmentSizeHandler || getImageAttachmentConfiguration,\n    maxNumberOfFiles: maxNumberOfFiles,\n    multipleUploads: multipleUploads,\n    mutes: mutes,\n    notifications: notifications,\n    onLinkPreviewDismissed: enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.onLinkPreviewDismissed,\n    quotedMessage: quotedMessage,\n    shouldGenerateVideoThumbnail: props.shouldGenerateVideoThumbnail || true,\n    videoAttachmentSizeHandler: props.videoAttachmentSizeHandler || getVideoAttachmentConfiguration,\n    watcher_count: state.watcherCount\n  }));\n  var channelActionContextValue = useMemo(function () {\n    return {\n      addNotification: addNotification,\n      closeThread: closeThread,\n      dispatch: dispatch,\n      editMessage: editMessage,\n      jumpToLatestMessage: jumpToLatestMessage,\n      jumpToMessage: jumpToMessage,\n      loadMore: loadMore,\n      loadMoreNewer: loadMoreNewer,\n      loadMoreThread: loadMoreThread,\n      onMentionsClick: onMentionsHoverOrClick,\n      onMentionsHover: onMentionsHoverOrClick,\n      openThread: openThread,\n      removeMessage: removeMessage,\n      retrySendMessage: retrySendMessage,\n      sendMessage: sendMessage,\n      setQuotedMessage: setQuotedMessage,\n      skipMessageDataMemoization: skipMessageDataMemoization,\n      updateMessage: updateMessage\n    };\n  }, [channel.cid, enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.findURLFn, enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.onLinkPreviewDismissed, loadMore, loadMoreNewer, quotedMessage, jumpToMessage, jumpToLatestMessage]);\n  var componentContextValue = useMemo(function () {\n    return {\n      Attachment: props.Attachment || DefaultAttachment,\n      AttachmentPreviewList: props.AttachmentPreviewList,\n      AutocompleteSuggestionHeader: props.AutocompleteSuggestionHeader,\n      AutocompleteSuggestionItem: props.AutocompleteSuggestionItem,\n      AutocompleteSuggestionList: props.AutocompleteSuggestionList,\n      Avatar: props.Avatar,\n      CooldownTimer: props.CooldownTimer,\n      DateSeparator: props.DateSeparator,\n      EditMessageInput: props.EditMessageInput,\n      EmojiIcon: props.EmojiIcon,\n      EmptyStateIndicator: props.EmptyStateIndicator,\n      FileUploadIcon: props.FileUploadIcon,\n      GiphyPreviewMessage: props.GiphyPreviewMessage,\n      HeaderComponent: props.HeaderComponent,\n      Input: props.Input,\n      LinkPreviewList: props.LinkPreviewList,\n      LoadingIndicator: props.LoadingIndicator,\n      Message: props.Message || MessageSimple,\n      MessageDeleted: props.MessageDeleted,\n      MessageListNotifications: props.MessageListNotifications,\n      MessageNotification: props.MessageNotification,\n      MessageOptions: props.MessageOptions,\n      MessageRepliesCountButton: props.MessageRepliesCountButton,\n      MessageStatus: props.MessageStatus,\n      MessageSystem: props.MessageSystem,\n      MessageTimestamp: props.MessageTimestamp,\n      ModalGallery: props.ModalGallery,\n      PinIndicator: props.PinIndicator,\n      QuotedMessage: props.QuotedMessage,\n      QuotedMessagePreview: props.QuotedMessagePreview,\n      ReactionSelector: props.ReactionSelector,\n      ReactionsList: props.ReactionsList,\n      SendButton: props.SendButton,\n      ThreadHead: props.ThreadHead,\n      ThreadHeader: props.ThreadHeader,\n      ThreadStart: props.ThreadStart,\n      TriggerProvider: props.TriggerProvider,\n      TypingIndicator: props.TypingIndicator,\n      VirtualMessage: props.VirtualMessage\n    };\n  }, []);\n  var emojiContextValue = useMemo(function () {\n    return {\n      Emoji: props.Emoji,\n      emojiConfig: emojiConfig,\n      EmojiIndex: props.EmojiIndex,\n      EmojiPicker: props.EmojiPicker\n    };\n  }, []);\n  var typingContextValue = useCreateTypingContext({\n    typing: typing\n  });\n  var className = clsx(chatClass, theme, channelClass);\n  if (state.error) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingErrorIndicator, {\n      error: state.error\n    }));\n  }\n  if (state.loading) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(LoadingIndicator, null));\n  }\n  if (!channel.watch) {\n    return React.createElement(\"div\", {\n      className: className\n    }, React.createElement(\"div\", null, t('Channel Missing')));\n  }\n  return React.createElement(\"div\", {\n    className: clsx(className, windowsEmojiClass)\n  }, React.createElement(ChannelStateProvider, {\n    value: channelStateContextValue\n  }, React.createElement(ChannelActionProvider, {\n    value: channelActionContextValue\n  }, React.createElement(ComponentProvider, {\n    value: componentContextValue\n  }, React.createElement(EmojiProvider, {\n    value: emojiContextValue\n  }, React.createElement(TypingProvider, {\n    value: typingContextValue\n  }, React.createElement(\"div\", {\n    className: \"\".concat(chatContainerClass)\n  }, dragAndDropWindow && React.createElement(DropzoneProvider, __assign({}, optionalMessageInputProps), children), !dragAndDropWindow && React.createElement(React.Fragment, null, children))))))));\n};\n/**\n * A wrapper component that provides channel data and renders children.\n * The Channel component provides the following contexts:\n * - [ChannelStateContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_state_context/)\n * - [ChannelActionContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_action_context/)\n * - [ComponentContext](https://getstream.io/chat/docs/sdk/react/contexts/component_context/)\n * - [EmojiContext](https://getstream.io/chat/docs/sdk/react/contexts/emoji_context/)\n * - [TypingContext](https://getstream.io/chat/docs/sdk/react/contexts/typing_context/)\n */\nexport var Channel = React.memo(UnMemoizedChannel);","map":{"version":3,"names":["__assign","__awaiter","__generator","__rest","React","useEffect","useLayoutEffect","useMemo","useReducer","useRef","useState","debounce","throttle","logChatPromiseExecution","nanoid","clsx","channelReducer","initialState","commonEmoji","defaultMinimalEmojis","emojiSetDef","useCreateChannelStateContext","useCreateTypingContext","useEditMessageHandler","useIsMounted","useMentionsHandlers","Attachment","DefaultAttachment","LoadingErrorIndicator","DefaultLoadingErrorIndicator","LoadingChannel","DefaultLoadingIndicator","MessageSimple","DropzoneProvider","ChannelActionProvider","ChannelStateProvider","ComponentProvider","useChatContext","EmojiProvider","useTranslationContext","TypingProvider","DEFAULT_INITIAL_CHANNEL_PAGE_SIZE","DEFAULT_NEXT_CHANNEL_PAGE_SIZE","DEFAULT_THREAD_PAGE_SIZE","hasMoreMessagesProbably","hasNotMoreMessages","defaultEmojiData","makeAddNotifications","getChannel","useChannelContainerClasses","getImageAttachmentConfiguration","getVideoAttachmentConfiguration","UnMemoizedChannel","props","propsChannel","channel","_a","EmptyPlaceholder","_b","LoadingIndicator","_c","contextChannel","channelsQueryState","customClasses","theme","_d","channelClass","chatClass","className","queryInProgress","createElement","error","cid","ChannelInner","key","acceptedFiles","activeUnreadHandler","children","doMarkReadRequest","doSendMessageRequest","doUpdateMessageRequest","dragAndDropWindow","emojiData","enrichURLForPreviewConfig","_e","maxNumberOfFiles","_f","multipleUploads","onMentionsClick","onMentionsHover","_g","optionalMessageInputProps","skipMessageDataMemoization","_h","client","latestMessageDatesByChannels","mutes","t","_j","chatContainerClass","windowsEmojiClass","_k","getConfig","channelConfig","setChannelConfig","_l","notifications","setNotifications","_m","quotedMessage","setQuotedMessage","notificationTimeouts","_o","loading","initialized","state","dispatch","isMounted","originalTitle","lastRead","Date","online","channelCapabilitiesArray","data","own_capabilities","emojiConfig","throttledCopyStateFromChannel","type","leading","trailing","markRead","disconnected","read_events","current","document","title","markReadThrottled","handleEvent","event","mainChannelUpdated","unread","messageDate","oldestID","label","message","parent_id","show_in_channel","user","id","userID","hidden","muteStatus","muted","countUnread","concat","created_at","getTime","messages","query","id_lt","limit","watchers","sent","errored","done","onVisibilityChange","members","_i","member","userId","user_id","config","e_1","trys","push","length","addEventListener","on","removeEventListener","off","forEach","clearTimeout","thread","find","m","addNotification","loadMoreFinished","hasMore","loadMore","oldestMessage","notHasMore","perPage","queryResponse","e_2","hasMoreMessages","window","navigator","onLine","loadingMore","loadingMoreNewer","status","console","warn","loadMoreNewer","newestMessage","newestId","e_3","hasMoreNewer","id_gt","latestMessages","clearHighlightedMessageTimeoutId","jumpToMessage","messageId","messageLimit","indexOfMessage","loadMessageIntoState","undefined","findIndex","Math","floor","highlightedMessageId","setTimeout","jumpToLatestMessage","hasMoreOlder","updateMessage","updatedMessage","addMessageSorted","parentId","isUserResponseArray","output","doSendMessage","customMessageData","options","attachments","mentioned_users","text","mentions","messageData","messageResponse","existingMessage","i","msg","responseTimestamp","existingMessageTimestamp","responseIsTheNewest","error_1","stringError","parsedError","map","quoted_message_id","sendMessage","updated_at","JSON","stringify","parse","errorStatusCode","parent","messagePreview","filterErrorMessages","__html","html","reactions","retrySendMessage","filter","attachment","og_scrape_url","removeMessage","openThread","preventDefault","closeThread","loadMoreThreadFinished","threadHasMore","threadMessages","loadMoreThread","parentID","oldMessages","oldestMessageID","threadHasMoreMessages","newThreadMessages","e_4","threadLoadingMore","threads","getReplies","onMentionsHoverOrClick","editMessage","typing","restState","channelStateContextValue","debounceURLEnrichmentMs","enrichURLForPreview","findURLFn","giphyVersion","imageAttachmentSizeHandler","onLinkPreviewDismissed","shouldGenerateVideoThumbnail","videoAttachmentSizeHandler","watcher_count","watcherCount","channelActionContextValue","componentContextValue","AttachmentPreviewList","AutocompleteSuggestionHeader","AutocompleteSuggestionItem","AutocompleteSuggestionList","Avatar","CooldownTimer","DateSeparator","EditMessageInput","EmojiIcon","EmptyStateIndicator","FileUploadIcon","GiphyPreviewMessage","HeaderComponent","Input","LinkPreviewList","Message","MessageDeleted","MessageListNotifications","MessageNotification","MessageOptions","MessageRepliesCountButton","MessageStatus","MessageSystem","MessageTimestamp","ModalGallery","PinIndicator","QuotedMessage","QuotedMessagePreview","ReactionSelector","ReactionsList","SendButton","ThreadHead","ThreadHeader","ThreadStart","TriggerProvider","TypingIndicator","VirtualMessage","emojiContextValue","Emoji","EmojiIndex","EmojiPicker","typingContextValue","watch","value","Fragment","Channel","memo"],"sources":["C:/Users/praka/OneDrive/Desktop/Tic-Tac-Toe/client/node_modules/stream-chat-react/dist/components/Channel/Channel.js"],"sourcesContent":["import { __assign, __awaiter, __generator, __rest } from \"tslib\";\nimport React, { useEffect, useLayoutEffect, useMemo, useReducer, useRef, useState, } from 'react';\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { logChatPromiseExecution, } from 'stream-chat';\nimport { nanoid } from 'nanoid';\nimport clsx from 'clsx';\nimport { channelReducer, initialState } from './channelState';\nimport { commonEmoji, defaultMinimalEmojis, emojiSetDef } from './emojiData';\nimport { useCreateChannelStateContext } from './hooks/useCreateChannelStateContext';\nimport { useCreateTypingContext } from './hooks/useCreateTypingContext';\nimport { useEditMessageHandler } from './hooks/useEditMessageHandler';\nimport { useIsMounted } from './hooks/useIsMounted';\nimport { useMentionsHandlers } from './hooks/useMentionsHandlers';\nimport { Attachment as DefaultAttachment } from '../Attachment/Attachment';\nimport { LoadingErrorIndicator as DefaultLoadingErrorIndicator, } from '../Loading';\nimport { LoadingChannel as DefaultLoadingIndicator } from './LoadingChannel';\nimport { MessageSimple } from '../Message/MessageSimple';\nimport { DropzoneProvider } from '../MessageInput/DropzoneProvider';\nimport { ChannelActionProvider, } from '../../context/ChannelActionContext';\nimport { ChannelStateProvider, } from '../../context/ChannelStateContext';\nimport { ComponentProvider } from '../../context/ComponentContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { EmojiProvider } from '../../context/EmojiContext';\nimport { useTranslationContext } from '../../context/TranslationContext';\nimport { TypingProvider } from '../../context/TypingContext';\nimport { DEFAULT_INITIAL_CHANNEL_PAGE_SIZE, DEFAULT_NEXT_CHANNEL_PAGE_SIZE, DEFAULT_THREAD_PAGE_SIZE, } from '../../constants/limits';\nimport { hasMoreMessagesProbably, hasNotMoreMessages } from '../MessageList/utils';\nimport defaultEmojiData from '../../stream-emoji.json';\nimport { makeAddNotifications } from './utils';\nimport { getChannel } from '../../utils/getChannel';\nimport { useChannelContainerClasses } from './hooks/useChannelContainerClasses';\nimport { getImageAttachmentConfiguration, getVideoAttachmentConfiguration, } from '../Attachment/attachment-sizing';\nvar UnMemoizedChannel = function (props) {\n    var propsChannel = props.channel, _a = props.EmptyPlaceholder, EmptyPlaceholder = _a === void 0 ? null : _a, LoadingErrorIndicator = props.LoadingErrorIndicator, _b = props.LoadingIndicator, LoadingIndicator = _b === void 0 ? DefaultLoadingIndicator : _b;\n    var _c = useChatContext('Channel'), contextChannel = _c.channel, channelsQueryState = _c.channelsQueryState, customClasses = _c.customClasses, theme = _c.theme;\n    var _d = useChannelContainerClasses({\n        customClasses: customClasses,\n    }), channelClass = _d.channelClass, chatClass = _d.chatClass;\n    var channel = propsChannel || contextChannel;\n    var className = clsx(chatClass, theme, channelClass);\n    if (channelsQueryState.queryInProgress === 'reload' && LoadingIndicator) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingIndicator, null)));\n    }\n    if (channelsQueryState.error && LoadingErrorIndicator) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingErrorIndicator, { error: channelsQueryState.error })));\n    }\n    if (!(channel === null || channel === void 0 ? void 0 : channel.cid)) {\n        return React.createElement(\"div\", { className: className }, EmptyPlaceholder);\n    }\n    // @ts-ignore\n    return React.createElement(ChannelInner, __assign({}, props, { channel: channel, key: channel.cid }));\n};\nvar ChannelInner = function (props) {\n    var _a;\n    var acceptedFiles = props.acceptedFiles, activeUnreadHandler = props.activeUnreadHandler, channel = props.channel, children = props.children, doMarkReadRequest = props.doMarkReadRequest, doSendMessageRequest = props.doSendMessageRequest, doUpdateMessageRequest = props.doUpdateMessageRequest, _b = props.dragAndDropWindow, dragAndDropWindow = _b === void 0 ? false : _b, _c = props.emojiData, emojiData = _c === void 0 ? defaultEmojiData : _c, enrichURLForPreviewConfig = props.enrichURLForPreviewConfig, _d = props.LoadingErrorIndicator, LoadingErrorIndicator = _d === void 0 ? DefaultLoadingErrorIndicator : _d, _e = props.LoadingIndicator, LoadingIndicator = _e === void 0 ? DefaultLoadingIndicator : _e, maxNumberOfFiles = props.maxNumberOfFiles, _f = props.multipleUploads, multipleUploads = _f === void 0 ? true : _f, onMentionsClick = props.onMentionsClick, onMentionsHover = props.onMentionsHover, _g = props.optionalMessageInputProps, optionalMessageInputProps = _g === void 0 ? {} : _g, skipMessageDataMemoization = props.skipMessageDataMemoization;\n    var _h = useChatContext('Channel'), client = _h.client, customClasses = _h.customClasses, latestMessageDatesByChannels = _h.latestMessageDatesByChannels, mutes = _h.mutes, theme = _h.theme;\n    var t = useTranslationContext('Channel').t;\n    var _j = useChannelContainerClasses({ customClasses: customClasses }), channelClass = _j.channelClass, chatClass = _j.chatClass, chatContainerClass = _j.chatContainerClass, windowsEmojiClass = _j.windowsEmojiClass;\n    var _k = useState(channel.getConfig()), channelConfig = _k[0], setChannelConfig = _k[1];\n    var _l = useState([]), notifications = _l[0], setNotifications = _l[1];\n    var _m = useState(), quotedMessage = _m[0], setQuotedMessage = _m[1];\n    var notificationTimeouts = [];\n    var _o = useReducer(channelReducer, __assign(__assign({}, initialState), { loading: !channel.initialized })), state = _o[0], dispatch = _o[1];\n    var isMounted = useIsMounted();\n    var originalTitle = useRef('');\n    var lastRead = useRef(new Date());\n    var online = useRef(true);\n    var channelCapabilitiesArray = (_a = channel.data) === null || _a === void 0 ? void 0 : _a.own_capabilities;\n    var emojiConfig = {\n        commonEmoji: commonEmoji,\n        defaultMinimalEmojis: defaultMinimalEmojis,\n        emojiData: emojiData,\n        emojiSetDef: emojiSetDef,\n    };\n    var throttledCopyStateFromChannel = throttle(function () { return dispatch({ channel: channel, type: 'copyStateFromChannelOnEvent' }); }, 500, {\n        leading: true,\n        trailing: true,\n    });\n    var markRead = function () {\n        if (channel.disconnected || !(channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events)) {\n            return;\n        }\n        lastRead.current = new Date();\n        if (doMarkReadRequest) {\n            doMarkReadRequest(channel);\n        }\n        else {\n            logChatPromiseExecution(channel.markRead(), 'mark read');\n        }\n        if (activeUnreadHandler) {\n            activeUnreadHandler(0, originalTitle.current);\n        }\n        else if (originalTitle.current) {\n            document.title = originalTitle.current;\n        }\n    };\n    var markReadThrottled = throttle(markRead, 500, { leading: true, trailing: true });\n    var handleEvent = function (event) { return __awaiter(void 0, void 0, void 0, function () {\n        var mainChannelUpdated, unread, messageDate, cid, oldestID;\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;\n        return __generator(this, function (_m) {\n            switch (_m.label) {\n                case 0:\n                    if (event.message) {\n                        dispatch({\n                            channel: channel,\n                            message: event.message,\n                            type: 'updateThreadOnEvent',\n                        });\n                    }\n                    if (event.type === 'user.watching.start' || event.type === 'user.watching.stop')\n                        return [2 /*return*/];\n                    if (event.type === 'typing.start' || event.type === 'typing.stop') {\n                        return [2 /*return*/, dispatch({ channel: channel, type: 'setTyping' })];\n                    }\n                    if (event.type === 'connection.changed' && typeof event.online === 'boolean') {\n                        online.current = event.online;\n                    }\n                    if (event.type === 'message.new') {\n                        mainChannelUpdated = true;\n                        if (((_a = event.message) === null || _a === void 0 ? void 0 : _a.parent_id) && !((_b = event.message) === null || _b === void 0 ? void 0 : _b.show_in_channel)) {\n                            mainChannelUpdated = false;\n                        }\n                        if (mainChannelUpdated && ((_d = (_c = event.message) === null || _c === void 0 ? void 0 : _c.user) === null || _d === void 0 ? void 0 : _d.id) !== client.userID) {\n                            if (!document.hidden) {\n                                markReadThrottled();\n                            }\n                            else if ((channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events) && !channel.muteStatus().muted) {\n                                unread = channel.countUnread(lastRead.current);\n                                if (activeUnreadHandler) {\n                                    activeUnreadHandler(unread, originalTitle.current);\n                                }\n                                else {\n                                    document.title = \"(\".concat(unread, \") \").concat(originalTitle.current);\n                                }\n                            }\n                        }\n                        if (((_f = (_e = event.message) === null || _e === void 0 ? void 0 : _e.user) === null || _f === void 0 ? void 0 : _f.id) === client.userID &&\n                            ((_g = event === null || event === void 0 ? void 0 : event.message) === null || _g === void 0 ? void 0 : _g.created_at) &&\n                            ((_h = event === null || event === void 0 ? void 0 : event.message) === null || _h === void 0 ? void 0 : _h.cid)) {\n                            messageDate = new Date(event.message.created_at);\n                            cid = event.message.cid;\n                            if (!latestMessageDatesByChannels[cid] ||\n                                latestMessageDatesByChannels[cid].getTime() < messageDate.getTime()) {\n                                latestMessageDatesByChannels[cid] = messageDate;\n                            }\n                        }\n                    }\n                    if (!(event.type === 'user.deleted')) return [3 /*break*/, 2];\n                    oldestID = (_l = (_k = (_j = channel.state) === null || _j === void 0 ? void 0 : _j.messages) === null || _k === void 0 ? void 0 : _k[0]) === null || _l === void 0 ? void 0 : _l.id;\n                    /**\n                     * As the channel state is not normalized we re-fetch the channel data. Thus, we avoid having to search for user references in the channel state.\n                     */\n                    return [4 /*yield*/, channel.query({\n                            messages: { id_lt: oldestID, limit: DEFAULT_NEXT_CHANNEL_PAGE_SIZE },\n                            watchers: { limit: DEFAULT_NEXT_CHANNEL_PAGE_SIZE },\n                        })];\n                case 1:\n                    /**\n                     * As the channel state is not normalized we re-fetch the channel data. Thus, we avoid having to search for user references in the channel state.\n                     */\n                    _m.sent();\n                    _m.label = 2;\n                case 2:\n                    throttledCopyStateFromChannel();\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    // useLayoutEffect here to prevent spinner. Use Suspense when it is available in stable release\n    useLayoutEffect(function () {\n        var errored = false;\n        var done = false;\n        var onVisibilityChange = function () {\n            if (!document.hidden)\n                markRead();\n        };\n        (function () { return __awaiter(void 0, void 0, void 0, function () {\n            var members, _i, _a, member, userId, _b, user, user_id, config, e_1;\n            var _c;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        if (!!channel.initialized) return [3 /*break*/, 4];\n                        _d.label = 1;\n                    case 1:\n                        _d.trys.push([1, 3, , 4]);\n                        members = [];\n                        if (!channel.id && ((_c = channel.data) === null || _c === void 0 ? void 0 : _c.members)) {\n                            for (_i = 0, _a = channel.data.members; _i < _a.length; _i++) {\n                                member = _a[_i];\n                                userId = void 0;\n                                if (typeof member === 'string') {\n                                    userId = member;\n                                }\n                                else if (typeof member === 'object') {\n                                    _b = member, user = _b.user, user_id = _b.user_id;\n                                    userId = user_id || (user === null || user === void 0 ? void 0 : user.id);\n                                }\n                                if (userId) {\n                                    members.push(userId);\n                                }\n                            }\n                        }\n                        return [4 /*yield*/, getChannel({ channel: channel, client: client, members: members })];\n                    case 2:\n                        _d.sent();\n                        config = channel.getConfig();\n                        setChannelConfig(config);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _d.sent();\n                        dispatch({ error: e_1, type: 'setError' });\n                        errored = true;\n                        return [3 /*break*/, 4];\n                    case 4:\n                        done = true;\n                        originalTitle.current = document.title;\n                        if (!errored) {\n                            dispatch({ channel: channel, type: 'initStateFromChannel' });\n                            if (channel.countUnread() > 0)\n                                markRead();\n                            // The more complex sync logic is done in Chat\n                            document.addEventListener('visibilitychange', onVisibilityChange);\n                            client.on('connection.changed', handleEvent);\n                            client.on('connection.recovered', handleEvent);\n                            client.on('user.updated', handleEvent);\n                            client.on('user.deleted', handleEvent);\n                            channel.on(handleEvent);\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); })();\n        return function () {\n            if (errored || !done)\n                return;\n            document.removeEventListener('visibilitychange', onVisibilityChange);\n            channel === null || channel === void 0 ? void 0 : channel.off(handleEvent);\n            client.off('connection.changed', handleEvent);\n            client.off('connection.recovered', handleEvent);\n            client.off('user.updated', handleEvent);\n            client.off('user.deleted', handleEvent);\n            notificationTimeouts.forEach(clearTimeout);\n        };\n    }, [channel.cid, doMarkReadRequest, channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.read_events]);\n    useEffect(function () {\n        var _a;\n        if (!state.thread)\n            return;\n        var message = (_a = state.messages) === null || _a === void 0 ? void 0 : _a.find(function (m) { var _a; return m.id === ((_a = state.thread) === null || _a === void 0 ? void 0 : _a.id); });\n        if (message)\n            dispatch({ message: message, type: 'setThread' });\n    }, [state.messages, state.thread]);\n    /** MESSAGE */\n    // Adds a temporary notification to message list, will be removed after 5 seconds\n    var addNotification = makeAddNotifications(setNotifications, notificationTimeouts);\n    var loadMoreFinished = debounce(function (hasMore, messages) {\n        if (!isMounted.current)\n            return;\n        dispatch({ hasMore: hasMore, messages: messages, type: 'loadMoreFinished' });\n    }, 2000, {\n        leading: true,\n        trailing: true,\n    });\n    var loadMore = function (limit) {\n        if (limit === void 0) { limit = DEFAULT_NEXT_CHANNEL_PAGE_SIZE; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var oldestMessage, notHasMore, oldestID, perPage, queryResponse, e_2, hasMoreMessages;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!online.current || !window.navigator.onLine)\n                            return [2 /*return*/, 0];\n                        oldestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[0];\n                        if (state.loadingMore || state.loadingMoreNewer || (oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.status) !== 'received') {\n                            return [2 /*return*/, 0];\n                        }\n                        notHasMore = hasNotMoreMessages(channel.state.messages.length, DEFAULT_INITIAL_CHANNEL_PAGE_SIZE);\n                        if (notHasMore) {\n                            loadMoreFinished(false, channel.state.messages);\n                            return [2 /*return*/, channel.state.messages.length];\n                        }\n                        dispatch({ loadingMore: true, type: 'setLoadingMore' });\n                        oldestID = oldestMessage === null || oldestMessage === void 0 ? void 0 : oldestMessage.id;\n                        perPage = limit;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.query({\n                                messages: { id_lt: oldestID, limit: perPage },\n                                watchers: { limit: perPage },\n                            })];\n                    case 2:\n                        queryResponse = _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_2 = _b.sent();\n                        console.warn('message pagination request failed with error', e_2);\n                        dispatch({ loadingMore: false, type: 'setLoadingMore' });\n                        return [2 /*return*/, 0];\n                    case 4:\n                        hasMoreMessages = queryResponse.messages.length === perPage;\n                        loadMoreFinished(hasMoreMessages, channel.state.messages);\n                        return [2 /*return*/, queryResponse.messages.length];\n                }\n            });\n        });\n    };\n    var loadMoreNewer = function (limit) {\n        if (limit === void 0) { limit = 100; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var newestMessage, newestId, perPage, queryResponse, e_3, hasMoreNewer;\n            var _a, _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!online.current || !window.navigator.onLine)\n                            return [2 /*return*/, 0];\n                        newestMessage = (_a = state === null || state === void 0 ? void 0 : state.messages) === null || _a === void 0 ? void 0 : _a[((_b = state === null || state === void 0 ? void 0 : state.messages) === null || _b === void 0 ? void 0 : _b.length) - 1];\n                        if (state.loadingMore || state.loadingMoreNewer)\n                            return [2 /*return*/, 0];\n                        dispatch({ loadingMoreNewer: true, type: 'setLoadingMoreNewer' });\n                        newestId = newestMessage === null || newestMessage === void 0 ? void 0 : newestMessage.id;\n                        perPage = limit;\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.query({\n                                messages: { id_gt: newestId, limit: perPage },\n                                watchers: { limit: perPage },\n                            })];\n                    case 2:\n                        queryResponse = _c.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_3 = _c.sent();\n                        console.warn('message pagination request failed with error', e_3);\n                        dispatch({ loadingMoreNewer: false, type: 'setLoadingMoreNewer' });\n                        return [2 /*return*/, 0];\n                    case 4:\n                        hasMoreNewer = channel.state.messages !== channel.state.latestMessages;\n                        dispatch({ hasMoreNewer: hasMoreNewer, messages: channel.state.messages, type: 'loadMoreNewerFinished' });\n                        return [2 /*return*/, queryResponse.messages.length];\n                }\n            });\n        });\n    };\n    var clearHighlightedMessageTimeoutId = useRef(null);\n    var jumpToMessage = function (messageId, messageLimit) {\n        if (messageLimit === void 0) { messageLimit = 100; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var indexOfMessage, hasMoreMessages;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        dispatch({ loadingMore: true, type: 'setLoadingMore' });\n                        return [4 /*yield*/, channel.state.loadMessageIntoState(messageId, undefined, messageLimit)];\n                    case 1:\n                        _a.sent();\n                        indexOfMessage = channel.state.messages.findIndex(function (message) { return message.id === messageId; });\n                        hasMoreMessages = indexOfMessage >= Math.floor(messageLimit / 2);\n                        loadMoreFinished(hasMoreMessages, channel.state.messages);\n                        dispatch({\n                            hasMoreNewer: channel.state.messages !== channel.state.latestMessages,\n                            highlightedMessageId: messageId,\n                            type: 'jumpToMessageFinished',\n                        });\n                        if (clearHighlightedMessageTimeoutId.current) {\n                            clearTimeout(clearHighlightedMessageTimeoutId.current);\n                        }\n                        clearHighlightedMessageTimeoutId.current = setTimeout(function () {\n                            clearHighlightedMessageTimeoutId.current = null;\n                            dispatch({ type: 'clearHighlightedMessage' });\n                        }, 500);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var jumpToLatestMessage = function () { return __awaiter(void 0, void 0, void 0, function () {\n        var hasMoreOlder;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, channel.state.loadMessageIntoState('latest')];\n                case 1:\n                    _a.sent();\n                    hasMoreOlder = channel.state.messages.length >= 25;\n                    loadMoreFinished(hasMoreOlder, channel.state.messages);\n                    dispatch({\n                        type: 'jumpToLatestMessage',\n                    });\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var updateMessage = function (updatedMessage) {\n        // add the message to the local channel state\n        channel.state.addMessageSorted(updatedMessage, true);\n        dispatch({\n            channel: channel,\n            parentId: state.thread && updatedMessage.parent_id,\n            type: 'copyMessagesFromChannel',\n        });\n    };\n    var isUserResponseArray = function (output) { var _a; return ((_a = output[0]) === null || _a === void 0 ? void 0 : _a.id) != null; };\n    var doSendMessage = function (message, customMessageData, options) { return __awaiter(void 0, void 0, void 0, function () {\n        var attachments, id, _a, mentioned_users, parent_id, text, mentions, messageData, messageResponse, existingMessage, i, msg, responseTimestamp, existingMessageTimestamp, responseIsTheNewest, error_1, stringError, parsedError;\n        var _b, _c;\n        return __generator(this, function (_d) {\n            switch (_d.label) {\n                case 0:\n                    attachments = message.attachments, id = message.id, _a = message.mentioned_users, mentioned_users = _a === void 0 ? [] : _a, parent_id = message.parent_id, text = message.text;\n                    mentions = isUserResponseArray(mentioned_users)\n                        ? mentioned_users.map(function (_a) {\n                            var id = _a.id;\n                            return id;\n                        })\n                        : mentioned_users;\n                    messageData = __assign({ attachments: attachments, id: id, mentioned_users: mentions, parent_id: parent_id, quoted_message_id: parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id) ? quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.id : undefined, text: text }, customMessageData);\n                    _d.label = 1;\n                case 1:\n                    _d.trys.push([1, 6, , 7]);\n                    messageResponse = void 0;\n                    if (!doSendMessageRequest) return [3 /*break*/, 3];\n                    return [4 /*yield*/, doSendMessageRequest(channel.cid, messageData, options)];\n                case 2:\n                    messageResponse = _d.sent();\n                    return [3 /*break*/, 5];\n                case 3: return [4 /*yield*/, channel.sendMessage(messageData, options)];\n                case 4:\n                    messageResponse = _d.sent();\n                    _d.label = 5;\n                case 5:\n                    existingMessage = void 0;\n                    for (i = channel.state.messages.length - 1; i >= 0; i--) {\n                        msg = channel.state.messages[i];\n                        if (msg.id === messageData.id) {\n                            existingMessage = msg;\n                            break;\n                        }\n                    }\n                    responseTimestamp = new Date(((_b = messageResponse === null || messageResponse === void 0 ? void 0 : messageResponse.message) === null || _b === void 0 ? void 0 : _b.updated_at) || 0).getTime();\n                    existingMessageTimestamp = ((_c = existingMessage === null || existingMessage === void 0 ? void 0 : existingMessage.updated_at) === null || _c === void 0 ? void 0 : _c.getTime()) || 0;\n                    responseIsTheNewest = responseTimestamp > existingMessageTimestamp;\n                    // Replace the message payload after send is completed\n                    // We need to check for the newest message payload, because on slow network, the response can arrive later than WS events message.new, message.updated.\n                    // Always override existing message in status \"sending\"\n                    if ((messageResponse === null || messageResponse === void 0 ? void 0 : messageResponse.message) &&\n                        (responseIsTheNewest || (existingMessage === null || existingMessage === void 0 ? void 0 : existingMessage.status) === 'sending')) {\n                        updateMessage(__assign(__assign({}, messageResponse.message), { status: 'received' }));\n                    }\n                    if (quotedMessage && parent_id === (quotedMessage === null || quotedMessage === void 0 ? void 0 : quotedMessage.parent_id))\n                        setQuotedMessage(undefined);\n                    return [3 /*break*/, 7];\n                case 6:\n                    error_1 = _d.sent();\n                    stringError = JSON.stringify(error_1);\n                    parsedError = stringError ? JSON.parse(stringError) : {};\n                    updateMessage(__assign(__assign({}, message), { error: parsedError, errorStatusCode: parsedError.status || undefined, status: 'failed' }));\n                    return [3 /*break*/, 7];\n                case 7: return [2 /*return*/];\n            }\n        });\n    }); };\n    var sendMessage = function (_a, customMessageData, options) {\n        var _b = _a.attachments, attachments = _b === void 0 ? [] : _b, _c = _a.mentioned_users, mentioned_users = _c === void 0 ? [] : _c, parent = _a.parent, _d = _a.text, text = _d === void 0 ? '' : _d;\n        return __awaiter(void 0, void 0, void 0, function () {\n            var messagePreview;\n            var _e;\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        channel.state.filterErrorMessages();\n                        messagePreview = __assign({ __html: text, attachments: attachments, created_at: new Date(), html: text, id: (_e = customMessageData === null || customMessageData === void 0 ? void 0 : customMessageData.id) !== null && _e !== void 0 ? _e : \"\".concat(client.userID, \"-\").concat(nanoid()), mentioned_users: mentioned_users, reactions: [], status: 'sending', text: text, type: 'regular', user: client.user }, ((parent === null || parent === void 0 ? void 0 : parent.id) ? { parent_id: parent.id } : null));\n                        updateMessage(messagePreview);\n                        return [4 /*yield*/, doSendMessage(messagePreview, customMessageData, options)];\n                    case 1:\n                        _f.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var retrySendMessage = function (message) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    updateMessage(__assign(__assign({}, message), { errorStatusCode: undefined, status: 'sending' }));\n                    if (message.attachments) {\n                        // remove scraped attachments added during the message composition in MessageInput to prevent sync issues\n                        message.attachments = message.attachments.filter(function (attachment) { return !attachment.og_scrape_url; });\n                    }\n                    return [4 /*yield*/, doSendMessage(message)];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var removeMessage = function (message) {\n        channel.state.removeMessage(message);\n        dispatch({\n            channel: channel,\n            parentId: state.thread && message.parent_id,\n            type: 'copyMessagesFromChannel',\n        });\n    };\n    /** THREAD */\n    var openThread = function (message, event) {\n        event === null || event === void 0 ? void 0 : event.preventDefault();\n        setQuotedMessage(function (current) {\n            if ((current === null || current === void 0 ? void 0 : current.parent_id) !== (message === null || message === void 0 ? void 0 : message.parent_id)) {\n                return undefined;\n            }\n            else {\n                return current;\n            }\n        });\n        dispatch({ channel: channel, message: message, type: 'openThread' });\n    };\n    var closeThread = function (event) {\n        event === null || event === void 0 ? void 0 : event.preventDefault();\n        dispatch({ type: 'closeThread' });\n    };\n    var loadMoreThreadFinished = debounce(function (threadHasMore, threadMessages) {\n        dispatch({\n            threadHasMore: threadHasMore,\n            threadMessages: threadMessages,\n            type: 'loadMoreThreadFinished',\n        });\n    }, 2000, { leading: true, trailing: true });\n    var loadMoreThread = function (limit) {\n        if (limit === void 0) { limit = DEFAULT_THREAD_PAGE_SIZE; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var parentID, oldMessages, oldestMessageID, queryResponse, threadHasMoreMessages, newThreadMessages, e_4;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (state.threadLoadingMore || !state.thread)\n                            return [2 /*return*/];\n                        dispatch({ type: 'startLoadingThread' });\n                        parentID = state.thread.id;\n                        if (!parentID) {\n                            return [2 /*return*/, dispatch({ type: 'closeThread' })];\n                        }\n                        oldMessages = channel.state.threads[parentID] || [];\n                        oldestMessageID = (_a = oldMessages[0]) === null || _a === void 0 ? void 0 : _a.id;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, channel.getReplies(parentID, {\n                                id_lt: oldestMessageID,\n                                limit: limit,\n                            })];\n                    case 2:\n                        queryResponse = _b.sent();\n                        threadHasMoreMessages = hasMoreMessagesProbably(queryResponse.messages.length, limit);\n                        newThreadMessages = channel.state.threads[parentID] || [];\n                        // next set loadingMore to false so we can start asking for more data\n                        loadMoreThreadFinished(threadHasMoreMessages, newThreadMessages);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_4 = _b.sent();\n                        loadMoreThreadFinished(false, oldMessages);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var onMentionsHoverOrClick = useMentionsHandlers(onMentionsHover, onMentionsClick);\n    var editMessage = useEditMessageHandler(doUpdateMessageRequest);\n    var typing = state.typing, restState = __rest(state, [\"typing\"]);\n    var channelStateContextValue = useCreateChannelStateContext(__assign(__assign({}, restState), { acceptedFiles: acceptedFiles, channel: channel, channelCapabilitiesArray: channelCapabilitiesArray, channelConfig: channelConfig, debounceURLEnrichmentMs: enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.debounceURLEnrichmentMs, dragAndDropWindow: dragAndDropWindow, enrichURLForPreview: props.enrichURLForPreview, findURLFn: enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.findURLFn, giphyVersion: props.giphyVersion || 'fixed_height', imageAttachmentSizeHandler: props.imageAttachmentSizeHandler || getImageAttachmentConfiguration, maxNumberOfFiles: maxNumberOfFiles, multipleUploads: multipleUploads, mutes: mutes, notifications: notifications, onLinkPreviewDismissed: enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.onLinkPreviewDismissed, quotedMessage: quotedMessage, shouldGenerateVideoThumbnail: props.shouldGenerateVideoThumbnail || true, videoAttachmentSizeHandler: props.videoAttachmentSizeHandler || getVideoAttachmentConfiguration, watcher_count: state.watcherCount }));\n    var channelActionContextValue = useMemo(function () { return ({\n        addNotification: addNotification,\n        closeThread: closeThread,\n        dispatch: dispatch,\n        editMessage: editMessage,\n        jumpToLatestMessage: jumpToLatestMessage,\n        jumpToMessage: jumpToMessage,\n        loadMore: loadMore,\n        loadMoreNewer: loadMoreNewer,\n        loadMoreThread: loadMoreThread,\n        onMentionsClick: onMentionsHoverOrClick,\n        onMentionsHover: onMentionsHoverOrClick,\n        openThread: openThread,\n        removeMessage: removeMessage,\n        retrySendMessage: retrySendMessage,\n        sendMessage: sendMessage,\n        setQuotedMessage: setQuotedMessage,\n        skipMessageDataMemoization: skipMessageDataMemoization,\n        updateMessage: updateMessage,\n    }); }, [\n        channel.cid,\n        enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.findURLFn,\n        enrichURLForPreviewConfig === null || enrichURLForPreviewConfig === void 0 ? void 0 : enrichURLForPreviewConfig.onLinkPreviewDismissed,\n        loadMore,\n        loadMoreNewer,\n        quotedMessage,\n        jumpToMessage,\n        jumpToLatestMessage,\n    ]);\n    var componentContextValue = useMemo(function () { return ({\n        Attachment: props.Attachment || DefaultAttachment,\n        AttachmentPreviewList: props.AttachmentPreviewList,\n        AutocompleteSuggestionHeader: props.AutocompleteSuggestionHeader,\n        AutocompleteSuggestionItem: props.AutocompleteSuggestionItem,\n        AutocompleteSuggestionList: props.AutocompleteSuggestionList,\n        Avatar: props.Avatar,\n        CooldownTimer: props.CooldownTimer,\n        DateSeparator: props.DateSeparator,\n        EditMessageInput: props.EditMessageInput,\n        EmojiIcon: props.EmojiIcon,\n        EmptyStateIndicator: props.EmptyStateIndicator,\n        FileUploadIcon: props.FileUploadIcon,\n        GiphyPreviewMessage: props.GiphyPreviewMessage,\n        HeaderComponent: props.HeaderComponent,\n        Input: props.Input,\n        LinkPreviewList: props.LinkPreviewList,\n        LoadingIndicator: props.LoadingIndicator,\n        Message: props.Message || MessageSimple,\n        MessageDeleted: props.MessageDeleted,\n        MessageListNotifications: props.MessageListNotifications,\n        MessageNotification: props.MessageNotification,\n        MessageOptions: props.MessageOptions,\n        MessageRepliesCountButton: props.MessageRepliesCountButton,\n        MessageStatus: props.MessageStatus,\n        MessageSystem: props.MessageSystem,\n        MessageTimestamp: props.MessageTimestamp,\n        ModalGallery: props.ModalGallery,\n        PinIndicator: props.PinIndicator,\n        QuotedMessage: props.QuotedMessage,\n        QuotedMessagePreview: props.QuotedMessagePreview,\n        ReactionSelector: props.ReactionSelector,\n        ReactionsList: props.ReactionsList,\n        SendButton: props.SendButton,\n        ThreadHead: props.ThreadHead,\n        ThreadHeader: props.ThreadHeader,\n        ThreadStart: props.ThreadStart,\n        TriggerProvider: props.TriggerProvider,\n        TypingIndicator: props.TypingIndicator,\n        VirtualMessage: props.VirtualMessage,\n    }); }, []);\n    var emojiContextValue = useMemo(function () { return ({\n        Emoji: props.Emoji,\n        emojiConfig: emojiConfig,\n        EmojiIndex: props.EmojiIndex,\n        EmojiPicker: props.EmojiPicker,\n    }); }, []);\n    var typingContextValue = useCreateTypingContext({\n        typing: typing,\n    });\n    var className = clsx(chatClass, theme, channelClass);\n    if (state.error) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingErrorIndicator, { error: state.error })));\n    }\n    if (state.loading) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(LoadingIndicator, null)));\n    }\n    if (!channel.watch) {\n        return (React.createElement(\"div\", { className: className },\n            React.createElement(\"div\", null, t('Channel Missing'))));\n    }\n    return (React.createElement(\"div\", { className: clsx(className, windowsEmojiClass) },\n        React.createElement(ChannelStateProvider, { value: channelStateContextValue },\n            React.createElement(ChannelActionProvider, { value: channelActionContextValue },\n                React.createElement(ComponentProvider, { value: componentContextValue },\n                    React.createElement(EmojiProvider, { value: emojiContextValue },\n                        React.createElement(TypingProvider, { value: typingContextValue },\n                            React.createElement(\"div\", { className: \"\".concat(chatContainerClass) },\n                                dragAndDropWindow && (React.createElement(DropzoneProvider, __assign({}, optionalMessageInputProps), children)),\n                                !dragAndDropWindow && React.createElement(React.Fragment, null, children)))))))));\n};\n/**\n * A wrapper component that provides channel data and renders children.\n * The Channel component provides the following contexts:\n * - [ChannelStateContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_state_context/)\n * - [ChannelActionContext](https://getstream.io/chat/docs/sdk/react/contexts/channel_action_context/)\n * - [ComponentContext](https://getstream.io/chat/docs/sdk/react/contexts/component_context/)\n * - [EmojiContext](https://getstream.io/chat/docs/sdk/react/contexts/emoji_context/)\n * - [TypingContext](https://getstream.io/chat/docs/sdk/react/contexts/typing_context/)\n */\nexport var Channel = React.memo(UnMemoizedChannel);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}