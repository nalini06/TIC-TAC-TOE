{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { find } from 'linkifyjs';\nimport { useCallback, useEffect, useRef } from 'react';\nimport debounce from 'lodash.debounce';\nimport { useChannelStateContext, useChatContext } from '../../../context';\nimport { LinkPreviewState, SetLinkPreviewMode } from '../types';\nexport var useLinkPreviews = function (_a) {\n  var _b;\n  var debounceURLEnrichmentMsInputContext = _a.debounceURLEnrichmentMs,\n    dispatch = _a.dispatch,\n    _c = _a.enrichURLForPreview,\n    enrichURLForPreview = _c === void 0 ? false : _c,\n    findURLFnInputContext = _a.findURLFn,\n    linkPreviews = _a.linkPreviews,\n    onLinkPreviewDismissedInputContext = _a.onLinkPreviewDismissed;\n  var client = useChatContext().client;\n  // FIXME: the value of channelConfig is stale due to omitting it from the memoization deps in useCreateChannelStateContext\n  var _d = useChannelStateContext(),\n    channelConfig = _d.channelConfig,\n    debounceURLEnrichmentMsChannelContext = _d.debounceURLEnrichmentMs,\n    findURLFnChannelContext = _d.findURLFn,\n    onLinkPreviewDismissedChannelContext = _d.onLinkPreviewDismissed;\n  var shouldDiscardEnrichQueries = useRef(false);\n  var findURLFn = findURLFnInputContext !== null && findURLFnInputContext !== void 0 ? findURLFnInputContext : findURLFnChannelContext;\n  var onLinkPreviewDismissed = onLinkPreviewDismissedInputContext !== null && onLinkPreviewDismissedInputContext !== void 0 ? onLinkPreviewDismissedInputContext : onLinkPreviewDismissedChannelContext;\n  var debounceURLEnrichmentMs = (_b = debounceURLEnrichmentMsInputContext !== null && debounceURLEnrichmentMsInputContext !== void 0 ? debounceURLEnrichmentMsInputContext : debounceURLEnrichmentMsChannelContext) !== null && _b !== void 0 ? _b : 1500;\n  var dismissLinkPreview = useCallback(function (linkPreview) {\n    onLinkPreviewDismissed === null || onLinkPreviewDismissed === void 0 ? void 0 : onLinkPreviewDismissed(linkPreview);\n    var previewToRemoveMap = new Map();\n    linkPreview.state = LinkPreviewState.DISMISSED;\n    previewToRemoveMap.set(linkPreview.og_scrape_url, linkPreview);\n    dispatch({\n      linkPreviews: previewToRemoveMap,\n      mode: SetLinkPreviewMode.UPSERT,\n      type: 'setLinkPreviews'\n    });\n  }, [onLinkPreviewDismissed]);\n  var findAndEnqueueURLsToEnrich = useCallback(debounce(function (text, mode) {\n    if (mode === void 0) {\n      mode = SetLinkPreviewMode.SET;\n    }\n    var urls = findURLFn ? findURLFn(text) : find(text, 'url').reduce(function (acc, link) {\n      if (link.isLink) acc.push(link.href);\n      return acc;\n    }, []);\n    shouldDiscardEnrichQueries.current = urls.length === 0;\n    dispatch({\n      linkPreviews: urls.reduce(function (acc, url) {\n        acc.set(url, {\n          og_scrape_url: url,\n          state: LinkPreviewState.QUEUED\n        });\n        return acc;\n      }, new Map()),\n      mode: mode,\n      type: 'setLinkPreviews'\n    });\n  }, debounceURLEnrichmentMs, {\n    leading: false,\n    trailing: true\n  }), [debounceURLEnrichmentMs, shouldDiscardEnrichQueries, findURLFn]);\n  var cancelURLEnrichment = useCallback(function () {\n    findAndEnqueueURLsToEnrich.cancel();\n    findAndEnqueueURLsToEnrich('');\n    findAndEnqueueURLsToEnrich.flush();\n  }, [findAndEnqueueURLsToEnrich]);\n  useEffect(function () {\n    var enqueuedLinks = Array.from(linkPreviews.values()).reduce(function (acc, linkPreview) {\n      if (linkPreview.state === 'queued') {\n        var loadingLinkPreview = __assign(__assign({}, linkPreview), {\n          state: LinkPreviewState.LOADING\n        });\n        acc.set(linkPreview.og_scrape_url, loadingLinkPreview);\n      }\n      return acc;\n    }, new Map());\n    if (!enqueuedLinks.size) return;\n    dispatch({\n      linkPreviews: enqueuedLinks,\n      mode: SetLinkPreviewMode.UPSERT,\n      type: 'setLinkPreviews'\n    });\n    enqueuedLinks.forEach(function (linkPreview) {\n      client.enrichURL(linkPreview.og_scrape_url)\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      .then(function (_a) {\n        var duration = _a.duration,\n          ogAttachment = __rest(_a, [\"duration\"]);\n        if (shouldDiscardEnrichQueries.current) return;\n        var linkPreviewsMap = new Map();\n        linkPreviewsMap.set(linkPreview.og_scrape_url, __assign(__assign({}, ogAttachment), {\n          state: LinkPreviewState.LOADED\n        }));\n        dispatch({\n          linkPreviews: linkPreviewsMap,\n          mode: SetLinkPreviewMode.UPSERT,\n          type: 'setLinkPreviews'\n        });\n      }).catch(function () {\n        var linkPreviewsMap = new Map();\n        linkPreviewsMap.set(linkPreview.og_scrape_url, __assign(__assign({}, linkPreview), {\n          state: LinkPreviewState.FAILED\n        }));\n        dispatch({\n          linkPreviews: linkPreviewsMap,\n          mode: SetLinkPreviewMode.UPSERT,\n          type: 'setLinkPreviews'\n        });\n      });\n    });\n  }, [shouldDiscardEnrichQueries, linkPreviews]);\n  return {\n    cancelURLEnrichment: cancelURLEnrichment,\n    dismissLinkPreview: dismissLinkPreview,\n    findAndEnqueueURLsToEnrich: (channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.url_enrichment) && enrichURLForPreview ? findAndEnqueueURLsToEnrich : undefined\n  };\n};","map":{"version":3,"names":["__assign","__rest","find","useCallback","useEffect","useRef","debounce","useChannelStateContext","useChatContext","LinkPreviewState","SetLinkPreviewMode","useLinkPreviews","_a","_b","debounceURLEnrichmentMsInputContext","debounceURLEnrichmentMs","dispatch","_c","enrichURLForPreview","findURLFnInputContext","findURLFn","linkPreviews","onLinkPreviewDismissedInputContext","onLinkPreviewDismissed","client","_d","channelConfig","debounceURLEnrichmentMsChannelContext","findURLFnChannelContext","onLinkPreviewDismissedChannelContext","shouldDiscardEnrichQueries","dismissLinkPreview","linkPreview","previewToRemoveMap","Map","state","DISMISSED","set","og_scrape_url","mode","UPSERT","type","findAndEnqueueURLsToEnrich","text","SET","urls","reduce","acc","link","isLink","push","href","current","length","url","QUEUED","leading","trailing","cancelURLEnrichment","cancel","flush","enqueuedLinks","Array","from","values","loadingLinkPreview","LOADING","size","forEach","enrichURL","then","duration","ogAttachment","linkPreviewsMap","LOADED","catch","FAILED","url_enrichment","undefined"],"sources":["C:/Users/praka/OneDrive/Desktop/Tic-Tac-Toe/client/node_modules/stream-chat-react/dist/components/MessageInput/hooks/useLinkPreviews.js"],"sourcesContent":["import { __assign, __rest } from \"tslib\";\nimport { find } from 'linkifyjs';\nimport { useCallback, useEffect, useRef } from 'react';\nimport debounce from 'lodash.debounce';\nimport { useChannelStateContext, useChatContext } from '../../../context';\nimport { LinkPreviewState, SetLinkPreviewMode } from '../types';\nexport var useLinkPreviews = function (_a) {\n    var _b;\n    var debounceURLEnrichmentMsInputContext = _a.debounceURLEnrichmentMs, dispatch = _a.dispatch, _c = _a.enrichURLForPreview, enrichURLForPreview = _c === void 0 ? false : _c, findURLFnInputContext = _a.findURLFn, linkPreviews = _a.linkPreviews, onLinkPreviewDismissedInputContext = _a.onLinkPreviewDismissed;\n    var client = useChatContext().client;\n    // FIXME: the value of channelConfig is stale due to omitting it from the memoization deps in useCreateChannelStateContext\n    var _d = useChannelStateContext(), channelConfig = _d.channelConfig, debounceURLEnrichmentMsChannelContext = _d.debounceURLEnrichmentMs, findURLFnChannelContext = _d.findURLFn, onLinkPreviewDismissedChannelContext = _d.onLinkPreviewDismissed;\n    var shouldDiscardEnrichQueries = useRef(false);\n    var findURLFn = findURLFnInputContext !== null && findURLFnInputContext !== void 0 ? findURLFnInputContext : findURLFnChannelContext;\n    var onLinkPreviewDismissed = onLinkPreviewDismissedInputContext !== null && onLinkPreviewDismissedInputContext !== void 0 ? onLinkPreviewDismissedInputContext : onLinkPreviewDismissedChannelContext;\n    var debounceURLEnrichmentMs = (_b = debounceURLEnrichmentMsInputContext !== null && debounceURLEnrichmentMsInputContext !== void 0 ? debounceURLEnrichmentMsInputContext : debounceURLEnrichmentMsChannelContext) !== null && _b !== void 0 ? _b : 1500;\n    var dismissLinkPreview = useCallback(function (linkPreview) {\n        onLinkPreviewDismissed === null || onLinkPreviewDismissed === void 0 ? void 0 : onLinkPreviewDismissed(linkPreview);\n        var previewToRemoveMap = new Map();\n        linkPreview.state = LinkPreviewState.DISMISSED;\n        previewToRemoveMap.set(linkPreview.og_scrape_url, linkPreview);\n        dispatch({\n            linkPreviews: previewToRemoveMap,\n            mode: SetLinkPreviewMode.UPSERT,\n            type: 'setLinkPreviews',\n        });\n    }, [onLinkPreviewDismissed]);\n    var findAndEnqueueURLsToEnrich = useCallback(debounce(function (text, mode) {\n        if (mode === void 0) { mode = SetLinkPreviewMode.SET; }\n        var urls = findURLFn\n            ? findURLFn(text)\n            : find(text, 'url').reduce(function (acc, link) {\n                if (link.isLink)\n                    acc.push(link.href);\n                return acc;\n            }, []);\n        shouldDiscardEnrichQueries.current = urls.length === 0;\n        dispatch({\n            linkPreviews: urls.reduce(function (acc, url) {\n                acc.set(url, { og_scrape_url: url, state: LinkPreviewState.QUEUED });\n                return acc;\n            }, new Map()),\n            mode: mode,\n            type: 'setLinkPreviews',\n        });\n    }, debounceURLEnrichmentMs, { leading: false, trailing: true }), [debounceURLEnrichmentMs, shouldDiscardEnrichQueries, findURLFn]);\n    var cancelURLEnrichment = useCallback(function () {\n        findAndEnqueueURLsToEnrich.cancel();\n        findAndEnqueueURLsToEnrich('');\n        findAndEnqueueURLsToEnrich.flush();\n    }, [findAndEnqueueURLsToEnrich]);\n    useEffect(function () {\n        var enqueuedLinks = Array.from(linkPreviews.values()).reduce(function (acc, linkPreview) {\n            if (linkPreview.state === 'queued') {\n                var loadingLinkPreview = __assign(__assign({}, linkPreview), { state: LinkPreviewState.LOADING });\n                acc.set(linkPreview.og_scrape_url, loadingLinkPreview);\n            }\n            return acc;\n        }, new Map());\n        if (!enqueuedLinks.size)\n            return;\n        dispatch({\n            linkPreviews: enqueuedLinks,\n            mode: SetLinkPreviewMode.UPSERT,\n            type: 'setLinkPreviews',\n        });\n        enqueuedLinks.forEach(function (linkPreview) {\n            client\n                .enrichURL(linkPreview.og_scrape_url)\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                .then(function (_a) {\n                var duration = _a.duration, ogAttachment = __rest(_a, [\"duration\"]);\n                if (shouldDiscardEnrichQueries.current)\n                    return;\n                var linkPreviewsMap = new Map();\n                linkPreviewsMap.set(linkPreview.og_scrape_url, __assign(__assign({}, ogAttachment), { state: LinkPreviewState.LOADED }));\n                dispatch({\n                    linkPreviews: linkPreviewsMap,\n                    mode: SetLinkPreviewMode.UPSERT,\n                    type: 'setLinkPreviews',\n                });\n            })\n                .catch(function () {\n                var linkPreviewsMap = new Map();\n                linkPreviewsMap.set(linkPreview.og_scrape_url, __assign(__assign({}, linkPreview), { state: LinkPreviewState.FAILED }));\n                dispatch({\n                    linkPreviews: linkPreviewsMap,\n                    mode: SetLinkPreviewMode.UPSERT,\n                    type: 'setLinkPreviews',\n                });\n            });\n        });\n    }, [shouldDiscardEnrichQueries, linkPreviews]);\n    return {\n        cancelURLEnrichment: cancelURLEnrichment,\n        dismissLinkPreview: dismissLinkPreview,\n        findAndEnqueueURLsToEnrich: (channelConfig === null || channelConfig === void 0 ? void 0 : channelConfig.url_enrichment) && enrichURLForPreview ? findAndEnqueueURLsToEnrich : undefined,\n    };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}